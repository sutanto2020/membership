var WebGuest=angular.module("WebGuest",["datatables","datatables.buttons","angularMoment","ui.calendar","ui.bootstrap.datetimepicker","angucomplete-alt","angular-nicescroll"]);WebGuest.directive("myformat",function(){return{require:"ngModel",link:function(t,e,a,n){n.$parsers.push(function(t){return+t})}}}),WebGuest.directive("delayFormat",["$timeout",function(t){return{restrict:"A",template:"<div>{{ test }}</div>",scope:{delayFormat:"="},link:function(e,a,n){var r=JSON.parse(JSON.stringify(e.delayFormat));if(r<=3600){var o=r%60,i=(r-o)/60,u=0;i>=60&&(u=(i-i%60)/60,i%=60);var s=(u>0?u+" hour"+(u>1?"s ":" "):"")+(i>0?i+" minute"+(i>1?"s ":" "):"")+(o>0?o+" second"+(o>1?"s ":" "):"");t(function(){e.test=s.length>0&&s.length<=3600?s:"No Data"},0)}else t(function(){e.test="No Data"},0);console.log("Do action with data",e.test)}}}]);
function BaseService(e,t){function n(n,r,o,u){var a=t.defer(),i=e({method:"POST",url:n.url+"?"+Date.now(),data:n.data,timeout:a.promise}),c=i.then(function(e){r&&r(e)},function(e){o&&o(e)});return c.abort=function(){a.resolve(),u&&u()},c}function r(n,r,o,u){var a=t.defer(),i=e({method:"GET",url:n.url+"?"+Date.now(),params:n.data,timeout:a.promise}),c=i.then(function(e){r&&r(e)},function(e){o&&o(e)});return c.abort=function(){a.resolve(),u&&u()},c}return{post:n,get:r}}WebGuest.factory("BaseService",["$http","$q",BaseService]);
angular.module("WebGuest").filter("pagination",function(){return function(n,u){return null==n?[]:(u=+u,n.slice(u))}});
function ChatController(e,t,n){function s(e){var t=null;return Global.HotelBrands.forEach(function(n){n.Name==e&&(t=n)}),t}e.LoadingOldMessage=!1,e.NoMoreOldMessage=!1,e.SoundNotification=!0,e.Message="",e.BroadcastMessage="",e.Search="",e.CurrentUserId=null,e.CurrentUserName="",e.CurrentUser=null,e.ChatHub=null,e.HubId=null,e.MyName="",e.Guests=[],e.selectedHotel={},e.selectedGuest={},e.selectedMessages=[],e.Hotels=[],e.ActiveMessages=[],e.NotifCount={},e.AttachmentLoaded=!1,e.BroadcastType="all",e.BroadcastCustomMode=1,e.BroadcastCustomModeNights=1,e.AttachmentsSelectedIndex=0,e.popoverSenderDetail=$("#popover-chat-sender-detail"),e.hoverMessage=null,e.Attachments=[{Caption:"",File:""},{Caption:"",File:""},{Caption:"",File:""},{Caption:"",File:""}],e.selectedAttachment={},e.Messages={};var a=function(){Global.Hotels.forEach(function(t){var n=s(t.BrandName);null!=n&&(t.BrandLogo=n.Logo),e.Hotels.push(t)})};a(),e.ShowHideAllUnits=function(){var e=$("#all-hotel-list"),t=600;e.is(":visible")?e.slideUp(t):e.slideDown(t)},e.SendMessage=function(){if(""==e.Message)return toastr.error("Please type the message first..."),!1;var t={toId:e.CurrentUserId,fromId:e.HubId,message:e.Message,from:e.MyName,source:"my",read:!0,time:Date.now()},n=e.Messages[t.toId];null==n&&(e.Messages[t.toId]=[]),e.Messages[t.toId].push(t),e.UpdateMessageList(),e.ChatHub.server.sendMessage(t),e.Message=""},e.ActivateChat=function(t){e.CurrentUserName=t.Name,e.CurrentUserId=t.Id,e.CurrentUser=t;var n=e.Messages[t.Id];if(null!=n)for(var s=0;s<n.length;s++)n[s].read=!0;e.UpdateMessageList()},e.UpdateMessageList=function(){e.ActiveMessages=e.Messages[e.CurrentUserId]},e.displayTime=function(e,t,n,s){return s?moment(e).fromNow():n?moment.unix(e).fromNow():null!=t?moment.utc(e).format(t):moment.utc(e).fromNow()},e.getUnreadCount=function(t){var n=0,s=e.Messages[t];return null==s?n:(s.forEach(function(e){e.read||n++}),n)},e.getTotalMessage=function(){var t=0,n=e.Messages[e.CurrentUserId];return t=null==n?0:n.length,t+" "+(t<=1?"message":"messages")},e.selectHotel=function(t){e.selectedHotel=t,e.ShowHideAllUnits(),Chat.GetAllGuests(t,!0)},e.IsMine=function(e){return e.Sender==Global.UserName},e.selectGuest=function(t){if(null!=t){if(e.NoMoreOldMessage=!1,Chat.ChatMessageHistoryLoading(!0),Chat.IsAttachmentOpen){if(!confirm("You are opening attachment preview, do you want to close it?"))return;Chat.ShowAttachmentPreview(!0)}e.selectedGuest=t;var n={TakeRow:50,HotelID:e.selectedHotel.HotelId,MemberID:e.selectedGuest.MemberID,GenerateSign:!0};Chat.ChatHub.server.getChat(n),e.NotifCount[t.MemberID]=0}},e.UpdateNotifCount=function(t,n){null!=t&&(t=t.toLowerCase()),null==e.NotifCount[t]&&(e.NotifCount[t]=0),null!=n?e.NotifCount[t]=n:e.NotifCount[t]++},e.ChangeAttachmentThumbnail=function(t){e.AttachmentsSelectedIndex=t},e.DisplayFileSize=function(e){return null==e||isNaN(e)?"N/A":filesize(e)},e.GetImageUrl=function(e,t){var n=e.Url,s=e.S;t&&(n+="-th",s=e.T),s=encodeURIComponent(s);var a="http://"+Global.ChatBucketName+".s3.amazonaws.com/"+n+"?Signature="+s+"&Expires="+e.j+"&AWSAccessKeyId="+e.k;return a},e.ShowAttachmentViewer=function(t){var n=$("#attachment-viewer");if(null==t)return n.hide(),void(e.selectedAttachment={});if(e.selectedAttachment=t,t.i){e.AttachmentLoaded=!1;var s=document.getElementById("attachment-viewer-image-img");s.src=e.GetImageUrl(t),s.onload=function(){e.$apply(function(){e.AttachmentLoaded=!0})}}n.show()},e.getUserChar=function(e){var t="?";return null!=e.Name&&e.Name.length>0&&(t=e.Name),t.substr(0,1)},e.getUserColor=function(e){var t=Chat.GenerateMaterialColor(e.MemberID);return{"background-color":t}},e.getSenderColor=function(t){var n="";n=e.IsMine(t)?Global.UserName:1==t.Role?t.Sender+"-admin-hotel":t.MemberID;var s=Chat.GenerateMaterialColor(n);return{"background-color":s}},e.ShowNumberOfGuest=function(){var n=$("#number-of-guest");n.html("loading..."),t.GetNumberOfGuest(e.selectedHotel.HotelId,e.BroadcastCustomMode,e.BroadcastCustomModeNights,function(e){var t=e.data;t>0?(t>1?t+=" guests":t="Only one guest",t="<span style='color:green'>"+t+" will receive this message</span>"):t="<span style='color:red'>No guest will receive this message.</span>",n.html(t)},function(e){n.html("")})},e.displayAsHtml=function(e){return null==e?"":null!=linkifyHtml?n.trustAsHtml(linkifyHtml(e)):e},e.ChatUserDetail=function(t,n,s){if(null!=t){var a=e.popoverSenderDetail;if(n&&0!=t.Role){e.hoverMessage=t;var o=a.width(),r=a.height(),l=$(s.target).offset();a.css("top",l.top-(r/2-17)),a.css("left",l.left-o),a.show()}else e.hoverMessage=null,a.hide()}},e.GetUserImageUrl=function(e,t){if(null==e)return null;var n=e.SenderPicture;return null!=n&&50!==t&&(n=n.replace("?sz=50","?sz="+t)),n},e.GetTotalUnredMessages=function(){var t=0;return e.Guests.forEach(function(n){null!=e.NotifCount&&(t=e.NotifCount[n.MemberID]||0)}),t}}WebGuest.controller("ChatController",["$scope","ChatService","$sce",ChatController]);
function onShowAdminList(){$("#divAdminList").show(),$("#divAdminHotelsList").hide()}function onShowAdminHotelList(){$("#divAdminList").hide(),$("#divAdminHotelsList").fadeIn()}function onViewAdminList(t){onShowAdminList(),$("#divAdminListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAdminList").html("");var e=apiServer+"/api/hotel",n={requestType:45,value:t};$.ajax({url:e,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$("#divAdminListContainer").css({"background-image":"none"}),$("#divtblAdminList").html('<table class="table table-bordered" id="tblAdminList"></table>');var e=$("#tblAdminList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:t,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Admin found."},aoColumns:[{mDataProp:"Email",sTitle:"E-mail Address",mRender:function(t,e,n){return n.Email}},{mDataProp:"AdminName",sTitle:"Full Name"},{mDataProp:"UserId",sTitle:"Action",bSortable:!1,mRender:function(t,e,n){if(isAdministrator){var i=n.AdminName;return null!=i&&""!=i&&" "!=i||(i=n.Email),'<button type="submit" class="btn btn-default btn-xs" onclick="onViewHotelListByAdmin(\''+n.Email+"', '"+i+"')\">Select</button>"}return"- unavailable -"}}],fnDrawCallback:function(){$("#tblAdminList tbody td").css({"font-size":"12px"})}});e.columns().eq(0).each(function(t){$("input",e.column(t).footer()).on("keyup change",function(){e.column(t).search(this.value).draw()})}),$("#tblAdminList tbody td").css({"font-size":"12px"}),$("#tblAdminList_wrapper .row-fluid:eq(0)").remove(),$("#tblAdminList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblAdminList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblAdminList_wrapper .row-fluid .span6").removeClass("span6")},error:function(t){$("#divAdminListContainer").css({"background-image":"none"}).html("").append("No Admin found.").show()}})}function onHotelOptionSelectChange(){var t=$("#filterHotelInAdminList").val();onViewAdminList(t)}function onShowAddNewHotelAdmin(t){$("#errorAdminAddAlert").hide(),$("#warningAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#formAdminAddAlert").show(),$("#btnCloseAdminAddAlert").show(),$("#btnOKAdminAddAlert").show(),$("#btnDoneAdminAddAlert").hide(),$("#selectHotel").val(""),$("#inputEmail").val(""),$("#inputIgnoreAstonOID").prop("checked",!1),$('input[name="iSelectedHotelId"]').val(t),$("#divAdminAddContainer").modal()}function onOKAddNewHotelAdmin(){var t=$("#inputEmail").val(),e=$("#inputIgnoreAstonOID").prop("checked"),n=$("#selectHotel").val();if(null==n||null==t||""==t)onErrorAddNewHotelAdmin("Please input Email and/or select any hotel that the email allowed to access");else{onWarningAddNewHotelAdmin();var i=apiServer+"/api/hotel",o={requestType:41,HotelAdmin:{email:t,ignoreastonoid:e,hotelid:n}};$.ajax({url:i,type:"post",data:JSON.stringify(o),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){null!=t?0==t.code?onSuccessAddNewHotelAdmin():onErrorAddNewHotelAdmin(t.message):onErrorAddNewHotelAdmin("Failed to save")},error:function(t){onErrorAddNewHotelAdmin("Failed to save")}})}}function onChangeAdminAdd(){$("#errorAdminAddAlert").fadeOut(),$("#warningAdminAddAlert").fadeOut(),$("#successAdminAddAlert").fadeOut(),$("#formAdminAddAlert").show(),$("#btnCloseAdminAddAlert").show(),$("#btnOKAdminAddAlert").show(),$("#btnDoneAdminAddAlert").hide()}function onErrorAddNewHotelAdmin(t){$("#warningAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#errorAdminAddContent").text(t),$("#errorAdminAddAlert").fadeIn(),$("#formAdminAddAlert").fadeIn(),$("#btnCloseAdminAddAlert").fadeIn(),$("#btnOKAdminAddAlert").fadeIn(),$("#btnDoneAdminAddAlert").hide()}function onWarningAddNewHotelAdmin(){$("#errorAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#formAdminAddAlert").hide(),$("#warningAdminAddAlert").fadeIn(),$("#btnCloseAdminAddAlert").hide(),$("#btnOKAdminAddAlert").hide(),$("#btnDoneAdminAddAlert").hide()}function onSuccessAddNewHotelAdmin(){$("#errorAdminAddAlert").hide(),$("#warningAdminAddAlert").hide(),$("#formAdminAddAlert").hide(),$("#successAdminAddAlert").fadeIn(),$("#btnCloseAdminAddAlert").hide(),$("#btnOKAdminAddAlert").hide(),$("#btnDoneAdminAddAlert").fadeIn()}function onViewHotelListByAdmin(t,e){onShowAdminHotelList(),$("#divAdminHotelsListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAdminHotelsList").html("");var n=apiServer+"/api/hotel",i={requestType:43,value:t};$.ajax({url:n,type:"post",data:JSON.stringify(i),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(n){$("#divAdminHotelsListName").html(e),$("#divtblAdminHotelsList").html('<table class="table table-bordered" id="tblAdminHotelsList"></table>'),$("#divAdminHotelsListContainer").css({"background-image":"none"});var i=$("#tblAdminHotelsList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:n,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Hotel Allowed found."},aoColumns:[{mDataProp:"HotelName",sTitle:"Hotel Name"},{mDataProp:"HotelId",sTitle:"Action",mRender:function(n,i,o){return'<button type="submit" class="btn btn-default btn-xs" onclick="window.open(\'http://astondata.com/hoteldb/HotelView.aspx?HotelId='+o.HotelId+'\',\'_blank\');">View</button><button type="submit" class="btn btn-default btn-xs" onclick="onRemoveHotelFromAdmin(\''+o.HotelId+"', '"+o.HotelName+"', '"+t+"', '"+e+"')\">Remove</button>"}}],fnDrawCallback:function(){$("#tblAdminHotelsList tbody td").css({"font-size":"12px"})}});i.columns().eq(0).each(function(t){$("input",i.column(t).footer()).on("keyup change",function(){i.column(t).search(this.value).draw()})}),$("#tblAdminHotelsList tbody td").css({"font-size":"12px"}),$("#tblAdminHotelsList_wrapper .row-fluid:eq(0)").remove(),$("#tblAdminHotelsList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblAdminHotelsList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblAdminHotelsList_wrapper .row-fluid .span6").removeClass("span6")},error:function(t){$("#divAdminHotelsListContainer").css({"background-image":"none"}).html("").append("No Hotel Allowed found.").show()}})}function onAddNewHotelAdmin(t){$('input[name="iEmailId"]').val(t),$("#divAdminHotelAddContainer").modal()}function onRemoveHotelFromAdmin(t,e,n,i){var o=confirm("Remove "+e+" from Allowed List?");if(1==o){$("#divAdminHotelsListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAdminHotelsList").html("");var d=apiServer+"/api/hotel",a={requestType:42,HotelAdmin:{email:n,hotelid:[t]}};$.ajax({url:d,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){null!=t?0==t.code?alert(e+" has been removed."):alert(t.message):alert("Failed to remove")},error:function(t){alert("Failed to remove")}}).done(function(t){onViewHotelListByAdmin(n,i)})}}function onViewAppConfigList(){$("#divAppConfigListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAppConfigList").html("");var t=apiServer+"/api/hotel",e={requestType:910};$.ajax({url:t,type:"post",data:JSON.stringify(e),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$("#divAppConfigListContainer").css({"background-image":"none"}),$("#divtblAppConfigList").html('<table class="table table-bordered" id="tblAppConfigList"></table>'),$("#tblAppConfigList").dataTable({bDestroy:!0,bRetrieve:!0,aaData:t,bPaginate:!1,bFilter:!1,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"Empty Application Configuration List."},aoColumns:[{mDataProp:"AppKey",sTitle:"Key Name",sWidth:"30%"},{mDataProp:"AppValue",sTitle:"Value",sWidth:"30%"},{mDataProp:"LastUpdateDateString",sTitle:"Last Update"},{mDataProp:"LastUpdateUser",sTitle:"Action",mRender:function(t,e,n){return'<button type="submit" class="btn btn-default btn-xs" onclick="onShowEditAppConfig(\''+n.AppKey+"','"+n.AppValue+"');\">Edit</button>"}}],fnDrawCallback:function(){$("#tblAppConfigList tbody td").css({"font-size":"12px"})}}),$("#tblAppConfigList tbody td").css({"font-size":"12px"}),$("#tblAppConfigList_wrapper .row-fluid:eq(0)").remove(),$("#tblAppConfigList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblAppConfigList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblAppConfigList_wrapper .row-fluid .span6").removeClass("span6")},error:function(t){$("#divAppConfigListContainer").css({"background-image":"none"}).html("").append("No Admin found.").show()}})}function onShowAddAppConfig(){$("#errorAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").show(),$("#btnCloseAppConfigEditAlert").show(),$("#btnOKAppConfigEditAlert").show(),$("#btnDoneAppConfigEditAlert").hide(),$("#inputAppKey").val(""),$("#inputAppKey").removeAttr("disabled"),$("#inputAppValue").val(""),$("#divAppConfigEditContainer").modal()}function onShowEditAppConfig(t,e){$("#errorAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").show(),$("#btnCloseAppConfigEditAlert").show(),$("#btnOKAppConfigEditAlert").show(),$("#btnDoneAppConfigEditAlert").hide(),$("#inputAppKey").val(t),$("#inputAppKey").attr("disabled","disabled"),$("#inputAppValue").val(e),$("#divAppConfigEditContainer").modal()}function onOKAppConfiEdit(){var t=$("#inputAppKey").val(),e=$("#inputAppValue").val();if(null==t||null==e||""==t||""==e)onErrorAppConfigEdit("Please input Key Name and Value for the application configuration to be saved");else{onWarningAppConfigEdit();var n=apiServer+"/api/hotel",i={requestType:920,AppConfig:{appkey:t,appvalue:e,userid:userId}};$.ajax({url:n,type:"post",data:JSON.stringify(i),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){null!=t?0==t.code?onSuccessAppConfigEdit():onErrorAppConfigEdit(t.message):onErrorAppConfigEdit("Failed to save")},error:function(t){onErrorAppConfigEdit("Error when try to save")}})}}function onErrorAppConfigEdit(t){$("#warningAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#errorAppConfigEditContent").text(t),$("#errorAppConfigEditAlert").fadeIn(),$("#formAppConfigEditAlert").fadeIn(),$("#btnCloseAppConfigEditAlert").fadeIn(),$("#btnOKAppConfigEditAlert").fadeIn(),$("#btnDoneAppConfigEditAlert").hide()}function onWarningAppConfigEdit(){$("#errorAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").fadeIn(),$("#btnCloseAppConfigEditAlert").hide(),$("#btnOKAppConfigEditAlert").hide(),$("#btnDoneAppConfigEditAlert").hide()}function onSuccessAppConfigEdit(){$("#errorAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").fadeIn(),$("#btnCloseAppConfigEditAlert").hide(),$("#btnOKAppConfigEditAlert").hide(),$("#btnDoneAppConfigEditAlert").fadeIn()}
!function(){function e(){$.connection.ChatHub.client.RefreshChatMessage=function(e){var t=n.Scope.LoadingOldMessage;if(t){var o=n.Scope.selectedMessages;n.UpdateScope("selectedMessages",e.concat(o)),n.UpdateScope("LoadingOldMessage",!1),0===e.length?(n.UpdateScope("NoMoreOldMessage",!0),n.ChatHistoryScrollTop(0)):n.ChatHistoryScrollTop(5)}else n.UpdateScope("selectedMessages",e),n.ChatHistoryScrollToBottom(),n.ChatMessageHistoryLoading(!1)}}function t(){$.connection.ChatHub.client.UpdateActiveMember=function(e){if(n.UpdateScope("Guests",e),e=a(e),null!=e&&e.length>0){var t=e[0];n.Scope.$apply(function(){n.Scope.selectGuest(t)})}else n.ChatMessageHistoryLoading(!0,"<span style='font-size: 20px !important;'>No Guest Selected</span>");n.Loading(!1)}}function o(){$.connection.ChatHub.client.PublishMessage=function(e){var t=n.Scope.selectedMessages||[];n.Scope.selectedHotel.HotelId;if(e.MemberID.toLowerCase()==n.Scope.selectedGuest.MemberID.toLowerCase()||2==e.Type&&n.Scope.selectedHotel.HotelId==e.HotelID){if(t.push(e),n.UpdateScope("selectedMessages",t),n.ChatHistoryScrollToBottom(),null!=e.Attachments&&e.Attachments.length>0){var o=e.Attachments[0],a=n.Scope.GetImageUrl(o,!0),s=new Image;s.onload=function(){n.ChatHistoryScrollToBottom()},s.onerror=function(){},s.src=a}}else{var c=e.MemberID;n.Scope.$apply(function(){n.Scope.UpdateNotifCount(c)}),Chat.ReOrderGuestList(c)}e.Sender!=Global.UserName&&n.Scope.SoundNotification&&n.BeepSound()}}function a(e){return e.forEach(function(e){""!=e.Name&&null!=e.Name||(e.Name=e.MemberID),null==e.Room&&(e.Room="N/A")}),e}var n={IsAttachmentOpen:!1,HubId:null,ChatHub:null,GuestHub:null,MessageHub:null,Scope:null,Init:function(){$.connection.hub.logging=!0,n.ActivateSignalRClientEvents(),$.connection.hub.start().done(function(){n.HubId=$.connection.hub.id,console.log("SignalR","Connection Started"),n.ChatHub=$.connection.ChatHub,n.GuestHub=$.connection.buttlerGuestServer,n.MessageHub=$.connection.buttlerMessageServer,n.Scope=angular.element("#all-hotel-list").scope();var e=n.Scope.Hotels[0];n.UpdateScope("selectedHotel",e),n.GetAllGuests(e)})},ShowBroadcastModal:function(e){null==e&&(e=!0);var t={show:e};$("#broadcast-modal").modal(t)},GetAllGuests:function(e,t){n.Loading(!0),n.UpdateScope("selectedMessages",[],t),n.UpdateScope("selectedGuest",{},t),n.JoinHotelGroup(e),this.ChatHub.server.getActiveMember(e.HotelId)},UpdateScope:function(e,t,o){o?n.Scope[e]=t:this.Scope.$apply(function(){n.Scope[e]=t})},ActivateSignalRClientEvents:function(){e(),t(),o()},JoinHotelGroup:function(e){this.ChatHub.server.join(e.HotelId)},SendMessage:function(e){13===event.keyCode&&(event.shiftKey||(this.DoSendMessage(e),event.preventDefault()))},DoSendMessage:function(e){var t=e?"BroadcastMessage":"Message";this.Log("Send message..."),this.Log(this.Scope.Message);var o=Global.UserName,a=n.Scope.selectedGuest.MemberID,s=1,c=n.Scope[t];if(""==c)return void toastr.error("Can't send empty message.");var r=e?2:1,i=Date.now(),l=n.Scope.selectedHotel.HotelId,d=0,p=0;"custom"==this.Scope.BroadcastType&&(d=this.Scope.BroadcastCustomMode,p=this.Scope.BroadcastCustomModeNights),$.connection.ChatHub.server.publish(a,l,s,c,o,r,i,d,p),n.UpdateScope(t,""),e&&(toastr.success("Broadcast message sent."),this.ShowBroadcastModal(!1))},Log:function(e){console.log(Date.now(),e)},Notif:function(e,t){toastr[e](t)},Loading:function(e,t){var o=t||"please wait...",a=$("#loading-backdrop");$("#loading-backdrop-message-text").html(o),e?a.show():a.hide()},ChatHistoryScrollToBottom:function(){var e=$("#chat-right-area-history");e.scrollTop(e.prop("scrollHeight"))},ChatHistoryScrollTop:function(e){var t=$("#chat-right-area-history");t.scrollTop(e)},BeepSound:function(){if(this.Scope.SoundNotification){var e=document.createElement("audio");e.src=Global.BaseUrl+"/Content/beep-08b.mp3",e.play()}},ShowAttachmentPreview:function(e){var t=$("#chat-right-area-attachment-preview"),o=n.IsBroadcast()?"file-attachment-broadcast":"file-attachment",a=$("#"+o);if(e)t.slideUp(),a.val(""),this.IsAttachmentOpen=!1;else{n.Scope.Attachments=[];for(var s=a[0].files,c=0,r=[],i=0;i<s.length;i++){var l=s[i],d={File:null,Caption:"",Index:i,IsImage:l.type.indexOf("image")!==-1,FileName:l.name,FileSize:l.size,ErrorMessage:""};d.IsImage||(d.ErrorMessage="not an image file");var p=d.FileSize<1048576;if(p||(d.IsImage||(d.ErrorMessage+=" and "),d.ErrorMessage="size larger than 1MB"),p&&d.IsImage){d.Index=c;var u=new FileReader;u.attachment=d,u.readAsDataURL(l),u.onload=function(e){var t=this.attachment;t.File=e.target.result,n.Scope.$apply(function(){n.Scope.Attachments[t.Index]=t,n.Scope.AttachmentsSelectedIndex=0})},c++}else r.push(d)}r.length>0&&r.forEach(function(e){toastr.error("<strong>"+e.FileName+"</strong> doesn't allowed to be upload, because it's "+e.ErrorMessage)}),c>0&&(t.slideDown(),this.IsAttachmentOpen=!0)}},UploadAttachments:function(){var e=n.IsBroadcast()?"attachment-form-broadcast":"attachment-form",t=new FormData(document.getElementById(e)),o=[];n.Scope.Attachments.forEach(function(e){o.push({Caption:e.Caption,Index:e.Index,FileName:e.FileName})});var a=Date.now()/1e3|0;t.append("captions",JSON.stringify(o)),t.append("hotelID",n.Scope.selectedHotel.HotelId),t.append("memberID",n.Scope.selectedGuest.MemberID),"custom"==this.Scope.BroadcastType?(t.append("BroadcastMode",n.Scope.BroadcastCustomMode),t.append("Nights",n.Scope.BroadcastCustomModeNights)):(t.append("BroadcastMode",0),t.append("Nights",0)),t.append("role",1),t.append("type",n.IsBroadcast()?2:1),t.append("chatTime",a),t.append("sender",Global.UserName);var s=new XMLHttpRequest;s.upload.addEventListener("progress",function(e){var t=Math.ceil(e.loaded/e.total*100);console.log(t),n.Loading(!0,"Uploading..."+t+"%")},!1),s.addEventListener("load",function(e){return console.log("Upload Complete"),n.Loading(!1),e.currentTarget.responseText.length>5?void toastr.error("There is an error while uploading file. You need to refresh this page first."):(n.ShowAttachmentPreview(!0),void toastr.success("File has been sent successfully."))},!1),s.addEventListener("error",function(e){toastr.error("There is an error while sending file.")},!1),s.open("POST",Global.BaseUrl+"/WebGuest/UploadAttachments"),s.send(t)},ChatMessageHistoryLoading:function(e,t){null==t&&(t="Loading...");var o=$("#chat-right-area-history-loading"),a=$("#chat-right-area-history-loading .content");a.html(t),e?o.show():o.hide()},IsBroadcast:function(){return $("#broadcast-modal").is(":visible")},ShowBroadcastForm:function(e){return n.IsAttachmentOpen?void toastr.warning("Attachment preview is running. Please close it first."):void $("#broadcast-modal").modal(e?"show":"hide")},OnScrollHistory:function(e){if(!n.Scope.NoMoreOldMessage){var t=e.target.scrollTop;if(t<=0&&!n.Scope.LoadingOldMessage){var o=n.Scope.selectedMessages;n.UpdateScope("LoadingOldMessage",!0);var a={SkipRow:o.length,TakeRow:20,HotelID:n.Scope.selectedHotel.HotelId,MemberID:n.Scope.selectedGuest.MemberID,GenerateSign:!0};n.ChatHub.server.getChat(a)}}},ReOrderGuestList:function(e){this.Scope.$apply(function(){n.Scope.Guests.forEach(function(t){t.MemberID.toLowerCase()==e.toLowerCase()&&(t.LastActivity=Date.now(),console.log("Move "+e+" to top."))})})},GenerateMaterialColor:function(e){var t=["E57373","F06292","BA68C8","9575CD","7986CB","64B5F6","4FC3F7","4DD0E1","4DB6AC","81C784","AED581","FF8A65","D4E157","FFD54F","FFB74D","A1887F","90A4AE"],o=1;return null!=e&&(e=e.toLowerCase(),o=e.hashCode()),"#"+t[Math.abs(o)%t.length]},ToggleSoundNotification:function(){this.UpdateScope("SoundNotification",!this.Scope.SoundNotification,!1)}};window.Chat=n}();
function CallNetworkService(e){function r(r,a,l,t,i){var c={url:WebApp.BaseUrl+"/api/"+r,data:a};e.post(c,l,t,i)}function a(r,a,l,t){var i={url:WebApp.BaseUrl+"/api/"+r};e.get(i,a,l,t)}return{CallService:r,CallGetService:a}}WebGuest.factory("CallNetworkService",["BaseService",CallNetworkService]);
function CheckInController(e,n,o,t){function r(e){var n=$("#modal-non-member-check-in-loading");n.html(e)}e.CheckInBy="email",e.BookingMethods=WebApp.BookingMethods,e.SelectedBookingMethod="-1",e.CheckInList=[],e.GridCheckInListOptions=o.newOptions(),e.GridCheckInListColumnDefs=[t.newColumnDef(0)],e.SelectedMemberCheckIn={},e.GridHistory={},e.GridHistoryOptions=o.newOptions(),e.GridHistoryColumns=[t.newColumnDef(0)],e.curPage=1,e.pageSize=10,e.NewMember={Hotel:"",Email:"",Name:"",Country:"",City:"",RoomNumber:"",CheckInDate:"",CheckOutDate:"",BookingMethod:"-1"},e.getCurrentUserBenefit=function(){return null==e.SelectedMemberCheckIn?[]:null==e.SelectedMemberCheckIn.Personal?[]:e.SelectedMemberCheckIn.Personal.StandardBenefits},e.CheckInNonMember=function(){var o=$("#modal-non-member-check-in-loading");o.html("Please wait, we are saving the data..."),n.CheckInNonMember(e.NewMember,function(e){e=e.data,e.success?(toastr.success("Member's data saved successfully."),$("#modal-non-member-check-in").modal("hide")):r(e.errorMessage)},function(e){r("Error occured.")})},e.getColor=function(e){var n=Chat.GenerateMaterialColor(e);return n},e.ViewCheckIn=function(e){onShowViewNewCheckInDefault(e.CheckInCode)},e.EditCheckIn=function(e){onShowEditNewCheckInDefault(e.CheckInCode)},e.CheckOut=function(e){onShowCheckOutModalCheckIn(e.HotelId,e.CheckInCode,e.MemberNumber,e)},e.GridHistoryGetTotalPages=function(){return null==e.SelectedMemberCheckIn||null==e.SelectedMemberCheckIn.Personal?[]:Math.ceil(e.SelectedMemberCheckIn.Personal.CheckInHistories.length/e.pageSize)},e.displayDate=function(e,n){return null==e?"":null!=n?moment(e).format(n):moment(e).fromNow()},e.EmailAcCallback=function(e){console.log("EmailAcCallback "+e),void 0!=e&&(void 0!=e.originalObject.Email?onChangeCardNumberCheckInAdd(e.originalObject.Email):onChangeCardNumberCheckInAdd(e.originalObject))},e.CardNumberAcCallback=function(e){console.log("CardNumberAcCallback "+e),console.log(e),void 0!=e&&onChangeCardNumberCheckInAdd(e.originalObject.CardNumber)},e.safeApply=function(e){var n=this.$root.$$phase;"$apply"==n||"$digest"==n?e&&"function"==typeof e&&e():this.$apply(e)}}WebGuest.controller("CheckInController",["$scope","CheckInService","DTOptionsBuilder","DTColumnDefBuilder",CheckInController]);
function onShowAdminList(){$("#divAdminList").show(),$("#divAdminHotelsList").hide()}function onShowAdminHotelList(){$("#divAdminList").hide(),$("#divAdminHotelsList").fadeIn()}function onViewAdminList(t){onShowAdminList(),$("#divAdminListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAdminList").html("");var e=apiServer+"/api/hotel",n={requestType:45,value:t};$.ajax({url:e,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$("#divAdminListContainer").css({"background-image":"none"}),$("#divtblAdminList").html('<table class="table table-bordered" id="tblAdminList"></table>');var e=$("#tblAdminList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:t,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Admin found."},aoColumns:[{mDataProp:"Email",sTitle:"E-mail Address",mRender:function(t,e,n){return n.Email}},{mDataProp:"AdminName",sTitle:"Full Name"},{mDataProp:"UserId",sTitle:"Action",bSortable:!1,mRender:function(t,e,n){if(isAdministrator){var i=n.AdminName;return(null==i||""==i||" "==i)&&(i=n.Email),'<button type="submit" class="btn btn-default btn-xs" onclick="onViewHotelListByAdmin(\''+n.Email+"', '"+i+"')\">Select</button>"}return"- unavailable -"}}],fnDrawCallback:function(){$("#tblAdminList tbody td").css({"font-size":"12px"})}});e.columns().eq(0).each(function(t){$("input",e.column(t).footer()).on("keyup change",function(){e.column(t).search(this.value).draw()})}),$("#tblAdminList tbody td").css({"font-size":"12px"}),$("#tblAdminList_wrapper .row-fluid:eq(0)").remove(),$("#tblAdminList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblAdminList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblAdminList_wrapper .row-fluid .span6").removeClass("span6")},error:function(){$("#divAdminListContainer").css({"background-image":"none"}).html("").append("No Admin found.").show()}})}function onHotelOptionSelectChange(){var t=$("#filterHotelInAdminList").val();onViewAdminList(t)}function onShowAddNewHotelAdmin(t){$("#errorAdminAddAlert").hide(),$("#warningAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#formAdminAddAlert").show(),$("#btnCloseAdminAddAlert").show(),$("#btnOKAdminAddAlert").show(),$("#btnDoneAdminAddAlert").hide(),$("#selectHotel").val(""),$("#inputEmail").val(""),$("#inputIgnoreAstonOID").prop("checked",!1),$('input[name="iSelectedHotelId"]').val(t),$("#divAdminAddContainer").modal()}function onOKAddNewHotelAdmin(){var t,e,n=$("#inputEmail").val(),i=$("#inputIgnoreAstonOID").prop("checked"),o=$("#selectHotel").val();null==o||null==n||""==n?onErrorAddNewHotelAdmin("Please input Email and/or select any hotel that the email allowed to access"):(onWarningAddNewHotelAdmin(),t=apiServer+"/api/hotel",e={requestType:41,HotelAdmin:{email:n,ignoreastonoid:i,hotelid:o}},$.ajax({url:t,type:"post",data:JSON.stringify(e),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){null!=t?0==t.code?onSuccessAddNewHotelAdmin():onErrorAddNewHotelAdmin(t.message):onErrorAddNewHotelAdmin("Failed to save")},error:function(){onErrorAddNewHotelAdmin("Failed to save")}}))}function onChangeAdminAdd(){$("#errorAdminAddAlert").fadeOut(),$("#warningAdminAddAlert").fadeOut(),$("#successAdminAddAlert").fadeOut(),$("#formAdminAddAlert").show(),$("#btnCloseAdminAddAlert").show(),$("#btnOKAdminAddAlert").show(),$("#btnDoneAdminAddAlert").hide()}function onErrorAddNewHotelAdmin(t){$("#warningAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#errorAdminAddContent").text(t),$("#errorAdminAddAlert").fadeIn(),$("#formAdminAddAlert").fadeIn(),$("#btnCloseAdminAddAlert").fadeIn(),$("#btnOKAdminAddAlert").fadeIn(),$("#btnDoneAdminAddAlert").hide()}function onWarningAddNewHotelAdmin(){$("#errorAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#successAdminAddAlert").hide(),$("#formAdminAddAlert").hide(),$("#warningAdminAddAlert").fadeIn(),$("#btnCloseAdminAddAlert").hide(),$("#btnOKAdminAddAlert").hide(),$("#btnDoneAdminAddAlert").hide()}function onSuccessAddNewHotelAdmin(){$("#errorAdminAddAlert").hide(),$("#warningAdminAddAlert").hide(),$("#formAdminAddAlert").hide(),$("#successAdminAddAlert").fadeIn(),$("#btnCloseAdminAddAlert").hide(),$("#btnOKAdminAddAlert").hide(),$("#btnDoneAdminAddAlert").fadeIn()}function onViewHotelListByAdmin(t,e){onShowAdminHotelList(),$("#divAdminHotelsListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAdminHotelsList").html("");var n=apiServer+"/api/hotel",i={requestType:43,value:t};$.ajax({url:n,type:"post",data:JSON.stringify(i),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(n){$("#divAdminHotelsListName").html(e),$("#divtblAdminHotelsList").html('<table class="table table-bordered" id="tblAdminHotelsList"></table>'),$("#divAdminHotelsListContainer").css({"background-image":"none"});var i=$("#tblAdminHotelsList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:n,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Hotel Allowed found."},aoColumns:[{mDataProp:"HotelName",sTitle:"Hotel Name"},{mDataProp:"HotelId",sTitle:"Action",mRender:function(n,i,o){return'<button type="submit" class="btn btn-default btn-xs" onclick="window.open(\'http://astondata.com/hoteldb/HotelView.aspx?HotelId='+o.HotelId+'\',\'_blank\');">View</button><button type="submit" class="btn btn-default btn-xs" onclick="onRemoveHotelFromAdmin(\''+o.HotelId+"', '"+o.HotelName+"', '"+t+"', '"+e+"')\">Remove</button>"}}],fnDrawCallback:function(){$("#tblAdminHotelsList tbody td").css({"font-size":"12px"})}});i.columns().eq(0).each(function(t){$("input",i.column(t).footer()).on("keyup change",function(){i.column(t).search(this.value).draw()})}),$("#tblAdminHotelsList tbody td").css({"font-size":"12px"}),$("#tblAdminHotelsList_wrapper .row-fluid:eq(0)").remove(),$("#tblAdminHotelsList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblAdminHotelsList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblAdminHotelsList_wrapper .row-fluid .span6").removeClass("span6")},error:function(){$("#divAdminHotelsListContainer").css({"background-image":"none"}).html("").append("No Hotel Allowed found.").show()}})}function onAddNewHotelAdmin(t){$('input[name="iEmailId"]').val(t),$("#divAdminHotelAddContainer").modal()}function onRemoveHotelFromAdmin(t,e,n,i){var o=confirm("Remove "+e+" from Allowed List?");if(1==o){$("#divAdminHotelsListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAdminHotelsList").html("");var d=apiServer+"/api/hotel",a={requestType:42,HotelAdmin:{email:n,hotelid:[t]}};$.ajax({url:d,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){null!=t?0==t.code?alert(e+" has been removed."):alert(t.message):alert("Failed to remove")},error:function(){alert("Failed to remove")}}).done(function(){onViewHotelListByAdmin(n,i)})}}function onViewAppConfigList(){$("#divAppConfigListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblAppConfigList").html("");var t=apiServer+"/api/hotel";$.ajax({url:t,type:"post",data:JSON.stringify({requestType:910}),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$("#divAppConfigListContainer").css({"background-image":"none"}),$("#divtblAppConfigList").html('<table class="table table-bordered" id="tblAppConfigList"></table>'),$("#tblAppConfigList").dataTable({bDestroy:!0,bRetrieve:!0,aaData:t,bPaginate:!1,bFilter:!1,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"Empty Application Configuration List."},aoColumns:[{mDataProp:"AppKey",sTitle:"Key Name",sWidth:"30%"},{mDataProp:"AppValue",sTitle:"Value",sWidth:"30%"},{mDataProp:"LastUpdateDateString",sTitle:"Last Update"},{mDataProp:"LastUpdateUser",sTitle:"Action",mRender:function(t,e,n){return'<button type="submit" class="btn btn-default btn-xs" onclick="onShowEditAppConfig(\''+n.AppKey+"','"+n.AppValue+"');\">Edit</button>"}}],fnDrawCallback:function(){$("#tblAppConfigList tbody td").css({"font-size":"12px"})}}),$("#tblAppConfigList tbody td").css({"font-size":"12px"}),$("#tblAppConfigList_wrapper .row-fluid:eq(0)").remove(),$("#tblAppConfigList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblAppConfigList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblAppConfigList_wrapper .row-fluid .span6").removeClass("span6")},error:function(){$("#divAppConfigListContainer").css({"background-image":"none"}).html("").append("No Admin found.").show()}})}function onShowAddAppConfig(){$("#errorAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").show(),$("#btnCloseAppConfigEditAlert").show(),$("#btnOKAppConfigEditAlert").show(),$("#btnDoneAppConfigEditAlert").hide(),$("#inputAppKey").val(""),$("#inputAppKey").removeAttr("disabled"),$("#inputAppValue").val(""),$("#divAppConfigEditContainer").modal()}function onShowEditAppConfig(t,e){$("#errorAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").show(),$("#btnCloseAppConfigEditAlert").show(),$("#btnOKAppConfigEditAlert").show(),$("#btnDoneAppConfigEditAlert").hide(),$("#inputAppKey").val(t),$("#inputAppKey").attr("disabled","disabled"),$("#inputAppValue").val(e),$("#divAppConfigEditContainer").modal()}function onOKAppConfiEdit(){var t,e,n=$("#inputAppKey").val(),i=$("#inputAppValue").val();null==n||null==i||""==n||""==i?onErrorAppConfigEdit("Please input Key Name and Value for the application configuration to be saved"):(onWarningAppConfigEdit(),t=apiServer+"/api/hotel",e={requestType:920,AppConfig:{appkey:n,appvalue:i,userid:userId}},$.ajax({url:t,type:"post",data:JSON.stringify(e),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){null!=t?0==t.code?onSuccessAppConfigEdit():onErrorAppConfigEdit(t.message):onErrorAppConfigEdit("Failed to save")},error:function(){onErrorAppConfigEdit("Error when try to save")}}))}function onErrorAppConfigEdit(t){$("#warningAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#errorAppConfigEditContent").text(t),$("#errorAppConfigEditAlert").fadeIn(),$("#formAppConfigEditAlert").fadeIn(),$("#btnCloseAppConfigEditAlert").fadeIn(),$("#btnOKAppConfigEditAlert").fadeIn(),$("#btnDoneAppConfigEditAlert").hide()}function onWarningAppConfigEdit(){$("#errorAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").fadeIn(),$("#btnCloseAppConfigEditAlert").hide(),$("#btnOKAppConfigEditAlert").hide(),$("#btnDoneAppConfigEditAlert").hide()}function onSuccessAppConfigEdit(){$("#errorAppConfigEditAlert").hide(),$("#warningAppConfigEditAlert").hide(),$("#formAppConfigEditAlert").hide(),$("#successAppConfigEditAlert").fadeIn(),$("#btnCloseAppConfigEditAlert").hide(),$("#btnOKAppConfigEditAlert").hide(),$("#btnDoneAppConfigEditAlert").fadeIn()}
function ChatService(e){function t(e){var t=Global.BaseUrl+"/api/chat/";return t+e}function r(r,a,u,c,i,n){var f={url:t("GetNumberOfGuest/"+r+"/"+a+"/"+u)};e.get(f,c,i,n)}return{GetNumberOfGuest:r}}WebGuest.factory("ChatService",["BaseService",ChatService]);
function CheckinRequestApprovalController(e,o,t,n){e.BookingMethods=WebApp.BookingMethods,e.SelectedBookingMethod="-1",e.SelectedRequest,e.SelectedHotel=null,e.ResetSelectedRequest=function(){e.SelectedRequest=null},e.Process=function(o){e.SelectedRequest=o,e.ShowProcessModal()},e.ShowProcessModal=function(){e.SelectedBookingMethod="-1",$("#modalCheckinRequestDetail").modal("show")},e.HideProcessModal=function(){$("#modalCheckinRequestDetail").modal("hide")},e.ConfirmApproval=function(o){var t="Checkin Request Approval";return"-1"===e.SelectedBookingMethod?void swal(t,"Please select Booking Method first","error"):void swal({title:t,text:"Approve "+o.MemberName+"'s request?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&e.ProcessRequest(o,"",!0)})},e.RejectApproval=function(o){swal({title:"Checkin Request Rejection",text:"Reject "+o.MemberName+"'s request?Please type the reason",type:"input",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#DD6B55",confirmButtonText:"Reject",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0,inputPlaceholder:"Write Rejection Reason"},function(t){return t!==!1&&(""===t?(swal.showInputError("You need to write something!"),!1):void(t&&e.ProcessRequest(o,t,!1)))})},e.operator,e.ProcessRequest=function(t,n,l){var s=(l?"Approve":"Reject")+" Request";showPleaseWait();var r="CheckinRequest/ProcessRequest",a={processby:e.operator,requestId:t.RequestId,isApproved:l,BookingMethod:e.SelectedBookingMethod,CheckinDate:t.sCheckinDate,CheckoutDate:t.sCheckoutDate,RoomNumber:t.RoomNumber,Reason:n};o.CallService(r,a,function(o){if(0===o.data.code){swal(s,"Success!","success"),e.HideProcessModal();var t=$("#filterCheckInRequestDefaultList").val();""==t&&(t=null),e.GetCheckinRequestApproval(t)}else swal(s,"Process failed, "+o.data.message,"warning");hidePleaseWait()},function(e){swal(s,"Process failed","error"),hidePleaseWait()})},e.GetCheckinRequestApproval=function(t){var n="Checkin Request",l="CheckinRequest/GetList",s={HotelID:t};o.CallService(l,s,function(o){0==o.data.code?(e.CheckinRequestApprovalList=o.data.checkinRequest,e.SelectedHotel=t):swal(n,"Failed to load "+n+", "+o.data.message,"warning")},function(e){swal(n,"Failed to load "+n,"error")})},e.dtOptions=t.newOptions().withDOM('C<"clear">lfrtip'),e.dtColumnDefs=[n.newColumnDef(0).notSortable(),n.newColumnDef(1).notSortable(),n.newColumnDef(2).notSortable(),n.newColumnDef(3).notSortable(),n.newColumnDef(4).notSortable(),n.newColumnDef(5).notSortable()]}WebGuest.controller("CheckinRequestApprovalController",["$scope","CallNetworkService","DTOptionsBuilder","DTColumnDefBuilder",CheckinRequestApprovalController]);
function deepCopy(e){var i,a=e;if(e&&"object"==typeof e){a="[object Array]"===Object.prototype.toString.call(e)?[]:{};for(i in e)a[i]=deepCopy(e[i])}return a}var modeServer=0,pleaseWaitDiv=$("#pleaseWaitDialog");showPleaseWait=function(){pleaseWaitDiv.modal()},hidePleaseWait=function(){pleaseWaitDiv.modal("hide")};var ShowDisclaimer=function(){$("#modalDisclaimer").modal("show")},HideDisclaimer=function(){$("#modalDisclaimer").modal("hide")};
function CheckInService(e){function c(c,n,r,t){var a={url:WebApp.BaseUrl+"/api/hotel/CheckInNonMember",data:c};e.post(a,n,r,t)}return{CheckInNonMember:c}}WebGuest.factory("CheckInService",["BaseService",CheckInService]);
function DisclaimerController(e,l,a,n){e.isApplied=!1,e.copyStorage={},e.isUpdate=!1,e.memberTypeList=null,e.disclaimers=null,e.currentDisclaimers=null,e.selectedMemberType=null,e.selectedDisclaimer=null,e.ResetSelectedDisclaimer=function(){e.selectedDisclaimer=null},e.SimilarChecked=function(){var l=!1;for(i=0;i<e.similarDisclaimerList.length;i++)e.similarDisclaimerList[i].checked===!0&&(l=!0);return l},$("#modalViewSimilarDisclaimer").on("hidden.bs.modal",function(){e.similarDisclaimerList=null}),e.ShowSimilarDisclaimerModal=function(){$("#modalViewSimilarDisclaimer").modal("show")},e.HideSimilarDisclaimerModal=function(){$("#modalViewSimilarDisclaimer").modal("hide")},e.cloneCandidateList=null,e.similarDisclaimerList=null,e.isCloneModalOpened=!1,e.ShowCloneDisclaimerModal=function(){e.isCloneModalOpened=!0,$("#modalViewCloneDisclaimer").modal("show")},e.HideCloneDisclaimerModal=function(){e.isCloneModalOpened=!1,$("#modalViewCloneDisclaimer").modal("hide")},e.CheckifCloneDisclaimerIsOpen=function(){return($("modalViewCloneDisclaimer").data("bs.modal")||{isShown:!1}).isShown},e.CheckifDisclaimerIsOpen=function(){return($("modalViewDisclaimer").data("bs.modal")||{isShown:!1}).isShown},e.ShowDisclaimerModal=function(){$("#modalViewDisclaimer").modal("show")},e.HideDisclaimerModal=function(){$("#modalViewDisclaimer").modal("hide")},e.ShowDisclaimerEditor=function(){$("#modalDisclaimerEditor").modal("show")},e.HideDisclaimerEditor=function(){$("#modalDisclaimerEditor").modal("hide")},e.OpenUpdate=function(i){e.isUpdate=!0,e.selectedDisclaimer=i,angular.copy(i,e.copyStorage),e.ShowDisclaimerEditor()},e.OpenClone=function(i){e.selectedDisclaimer=i,e.GetCloneCandidate(i)},e.OpenAdd=function(){e.isUpdate=!1,e.selectedDisclaimer=null,e.ShowDisclaimerEditor()},e.Delete=function(i){var a="Delete Disclaimer";swal({title:a,text:"Delete disclaimer?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"OK",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(n){if(n){var o="Admin/DeleteDisclaimer",s={DisclaimerId:i.Id};l.CallService(o,s,function(i){i.data.code>=0?(swal(a,"Success!","success"),e.disclaimers=null,e.HideDisclaimerEditor(),e.viewDisclaimer(e.selectedMemberType)):swal(a,"Delete Disclaimer failed, "+i.data.message,"warning")},function(e){swal(a,"Delete Disclaimer failed","error")})}})},e.Add=function(i){var a="Add Disclaimer";swal({title:a,text:"Add disclaimer?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"OK",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(n){if(n){var o="Admin/AddDisclaimer",s={MembershipTypeId:e.selectedMemberType.Id,Content:i.Content};l.CallService(o,s,function(i){i.data.code>=0?(swal(a,"Success!","success"),e.disclaimers=null,e.HideDisclaimerEditor(),e.viewDisclaimer(e.selectedMemberType)):swal(a,"Add Disclaimer failed, "+i.data.message,"warning")},function(e){swal(a,"Add Disclaimer failed","error")})}})},e.Update=function(i){var a="Update Disclaimer";swal({title:a,text:"Update disclaimer?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"OK",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(n){if(n){var o="Admin/UpdateDisclaimer",s={DisclaimerId:i.Id,Content:i.Content};l.CallService(o,s,function(i){i.data.code>=0?(swal(a,"Success!","success"),e.disclaimers=null,e.HideDisclaimerEditor(),e.viewDisclaimer(e.selectedMemberType),null!=e.copyStorage&&e.GetSimilarDisclaimer(e.copyStorage)):swal(a,"Update Disclaimer failed, "+i.data.message,"warning")},function(e){swal(a,"Update Disclaimer failed","error")})}})},e.ChangeSimilarDisclaimers=function(){var a="Changing Similar Disclaimer";if(e.SimilarChecked()===!1)return void swal(a,"Please check some of the similar list first!","error");var n=[];for(i=0;i<e.similarDisclaimerList.length;i++)e.similarDisclaimerList[i].checked===!0&&n.push(e.similarDisclaimerList[i].Id);swal({title:a,text:"Change Similar disclaimer?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"OK",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(i){if(i){var o="Admin/UpdateSimilarDisclaimer",s={DisclaimerId:e.selectedDisclaimer.Id,DisclaimerList:n};l.CallService(o,s,function(i){i.data.code>=0?(swal(a,"Success!","success"),e.HideSimilarDisclaimerModal(),e.disclaimers=null,e.viewDisclaimer(e.selectedMemberType)):swal(a,"Change Similar Disclaimer failed, "+i.data.message,"warning")},function(e){swal(a,"Change Similar Disclaimer failed","error")})}})},e.Clone=function(i){var a="Clone Disclaimer";swal({title:a,text:"Clone disclaimer?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"OK",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(n){if(n){var o="Admin/CloneDisclaimer",s={DisclaimerId:e.selectedDisclaimer.Id,MembershipTypeId:i.Id};l.CallService(o,s,function(i){i.data.code>=0?(swal(a,"Success!","success"),e.GetCloneCandidate(e.selectedDisclaimer),e.disclaimers=null,e.viewDisclaimer(e.selectedMemberType)):swal(a,"Clone Disclaimer failed, "+i.data.message,"warning")},function(e){swal(a,"Clone Disclaimer failed","error")})}})},e.Move=function(i,a){isMoveUp="up"===a;var n="Move "+a;swal({title:n,text:"Move disclaimer to "+a+"?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"OK",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(a){if(a){var o="Admin/MoveDisclaimer",s={DisclaimerId:i.Id,isMovingUp:isMoveUp};l.CallService(o,s,function(i){i.data.code>=0?(swal(n,"Success!","success"),e.disclaimers=null,e.viewDisclaimer(e.selectedMemberType)):swal(n,"Move failed, "+i.data.message,"warning")},function(e){swal(n,"Move failed","error")})}})},e.GetCloneCandidate=function(i){var a="Get Clone Candidate List",n="Admin/GetCloneCandidateDisclaimer",o={DisclaimerId:i.Id};l.CallService(n,o,function(i){0==i.data.code?(e.cloneCandidateList=i.data.candidate,e.CheckifCloneDisclaimerIsOpen()?1!=e.isApplied&&(e.isApplied=!0,e.$apply(function(){})):e.ShowCloneDisclaimerModal()):swal(a,"Failed to "+a+", "+i.data.message,"warning")},function(e){swal(a,"Failed to "+a,"error")})},e.GetSimilarDisclaimer=function(i){var a="Admin/GetSimilarDisclaimer",n={DisclaimerId:i.Id,Content:i.Content};l.CallService(a,n,function(i){0==i.data.code&&(e.similarDisclaimerList=i.data.similar,1!=e.isApplied&&(e.isApplied=!0,e.$apply(function(){})),e.similarDisclaimerList.length>0&&e.ShowSimilarDisclaimerModal())},function(e){})},e.viewDisclaimer=function(i){e.selectedMemberType=i,null===e.disclaimers?e.GetDisclaimer(!1,i):(e.currentDisclaimers=null,e.currentDisclaimers=e.disclaimers[i.Code],e.ShowDisclaimerModal())},e.GetDisclaimer=function(i,a){var n="Get Disclaimer List",o="Admin/GetDisclaimers";l.CallGetService(o,function(l){0==l.data.code?(e.disclaimers=l.data.disclaimers,null!=a&&(e.currentDisclaimers=e.disclaimers[a.Code]),1!=e.isApplied&&(e.isApplied=!0,e.$apply(function(){}))):i?(e.currentDisclaimers=null,e.currentDisclaimers=e.disclaimers[a.Code],e.ShowDisclaimerModal()):swal(n,"Failed to load "+n+", "+l.data.message,"warning")},function(e){swal(n,"Failed to load "+n,"error")})},e.GetMemberType=function(){var i="Member Type List",a="Admin/GetMemberType";l.CallGetService(a,function(l){0==l.data.code?e.memberTypeList=l.data.type:swal(i,"Failed to load "+i+", "+l.data.message,"warning")},function(e){swal(i,"Failed to load "+i,"error")})},e.dtOptions=a.newOptions().withDOM('C<"clear">lfrtip'),e.dtColumnDefs=[n.newColumnDef(0).notSortable(),n.newColumnDef(1).notSortable(),n.newColumnDef(2).notSortable(),n.newColumnDef(3).notSortable(),n.newColumnDef(4).notSortable(),n.newColumnDef(5).notSortable()],e.GetDisclaimer(!0,null),e.GetMemberType()}WebGuest.controller("DisclaimerController",["$scope","CallNetworkService","DTOptionsBuilder","DTColumnDefBuilder",DisclaimerController]);
function onViewACheckInDefaultList(e){$("#divACheckInDefaultListContainer").css({"min-height":"100px","background-image":"url('//cdn0.astondata.com/images/ajaxloader00_21643.gif')"}),$("#divtblACheckInDefaultList").html("");var a=""==e,t=apiServer+"/api/hotel",n={requestType:271,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divACheckInDefaultListContainer").css({"background-image":"none"}),$("#divtblACheckInDefaultList").html('<table class="table table-bordered" id="tblACheckInDefaultList"></table>'),$("#tblACheckInDefaultList").dataTable({bDestroy:!0,bRetrieve:!0,aaData:e.Data,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[1,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Accelerated Check-In Data found."},aoColumns:[{mDataProp:"HotelName",sTitle:"Hotel Name",bVisible:a,sWidth:"15%"},{mDataProp:"ETAText",sTitle:"ETA to Hotel"},{mDataProp:"CheckInText",sTitle:"Check-In"},{mDataProp:"CheckOutText",sTitle:"Check-Out"},{mDataProp:"MemberName",sTitle:"Member Name",sWidth:"20%",fnRender:function(e){return e.aData.MemberName+"<br/>"+e.aData.MemberNumber}},{mDataProp:"SubmitTimeText",sTitle:"Submit Time"},{mDataProp:"ACheckInStatusText",sTitle:"Status",sWidth:"10%"},{mDataProp:"ACheckInCode",sTitle:"Action",fnRender:function(e){return e.aData.ACheckInStatus<=0?'<button type="submit" class="btn btn-default btn-xs" onclick="onShowEditNewACheckInDefault(\''+e.aData.ACheckInCode+"');\">Process</button>":'<button type="submit" class="btn btn-default btn-xs" onclick="onShowEditNewACheckInDefault(\''+e.aData.ACheckInCode+"');\">View</button>"}}],fnDrawCallback:function(){$("#tblACheckInDefaultList tbody td").css({"font-size":"12px"})}}).columns().eq(0).each(function(e){$("input",table.column(e).footer()).on("keyup change",function(){table.column(e).search(this.value).draw()})}),$("#tblACheckInDefaultList tbody td").css({"font-size":"12px"}),$("#tblACheckInDefaultList_wrapper .row-fluid:eq(0)").remove(),$("#tblACheckInDefaultList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblACheckInDefaultList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblACheckInDefaultList_wrapper .row-fluid .span6").removeClass("span6")},error:function(e){$("#divACheckInDefaultListContainer").css({"background-image":"none"}).html("").append("No Accelerated Check-In found.").show()}})}function onOptionSelectChangeACheckInDefault(){var e=$("#filterACheckInDefaultList").val();onViewACheckInDefaultList(e)}function onShowEditNewACheckInDefault(e){location.href=apiServer+"/WebGuest/ACheckInView/"+e}function onShowBase64ImgACheckInDefault(e){var a="data:image/jpeg;base64, "+e;$("#base64image").attr("src",a),$("#base64imageFull").attr("src",a)}function onOKACheckInView(){var e=$("#Data_ACheckInStatus").val();$("#divACheckInViewResponseContainer").modal(),$("#RespStatus").val(e),$("#RespStatus").focus()}function onViewCheckInDefaultList(e){var a=WebApp.GetCheckInScope(),t=apiServer+"/api/hotel",n={requestType:231,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){a.$apply(function(){a.CheckInList=e.Data})},error:function(e){$("#divCheckInDefaultListContainer").css({"background-image":"none"}).html("").append("No Accelerated Check-In found.").show()}})}function onViewCheckInADefaultList(e){var a=$("#divCheckInDefaultListContainer");a.css({"min-height":"100px","background-image":"url('//cdn0.astondata.com/images/ajaxloader00_21643.gif')"}),a.show();var t=$("#tblCheckInDefaultList"),n=apiServer+"/api/hotel",r={requestType:272,value:e};$.ajax({url:n,type:"post",data:JSON.stringify(r),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){t.show(),a.hide()},error:function(e){$("#divCheckInADefaultListContainer").css({"background-image":"none"}).html("").append("No Accelerated Check-In found.").show()}})}function onOptionSelectChangeCheckInDefault(){var e=$("#filterCheckInDefaultList").val(),a=$("#filterCheckInAdd").val();""==a&&$("#filterCheckInAdd").val(e),onViewCheckInDefaultList(e)}function onClearMemberData(){$("#Data_Gender").html(""),$("#Data_Telephone").html(""),$("#Data_Email").html(""),$("#Data_Country").html(""),$("#Data_City").html(""),$("#Data_Custom").html(""),$("#Data_Preferences").html(""),$("#Data_Options").html(""),$("#Data_Priorities").html(""),$("#Data_Favorites").html(""),$("#Data_Member_Number").html(""),$("#Data_Member_JoinDate").html(""),$("#Data_Member_MemberType").html("");var e=WebApp.GetCheckInScope();e.safeApply(function(){e.SelectedMemberCheckIn=null})}function onCancelCheckInAdd(){var e=$("#btnSaveCheckInAdd").is(":visible")&&$("#Data_Email").text().length>0;onEnabledCheckInAdd();var a=WebApp.GetCheckInScope();a.safeApply(function(){a.SelectedMemberCheckIn=null}),$("#nonmemberdiv").hide(),$("#titleCheckInAdd").html("New Check-In"),$("#warningCheckInAddAlert").hide(),$("#successCheckInAddAlert").hide(),$("#errorCheckInAddAlert").hide();var t=$("#Data_CheckInCode").val();$("#Data_CheckInCode").val(""),$("#Data_HotelId").val(""),$("#filterCheckInAdd").val(""),$("#Data_MemberNumber").val(""),$("#Data_MemberNumber_value").val(""),$("#Data_RoomNumber").val(""),$("#Data_CheckInDate").val(""),$("#Data_CheckOutDate").val(""),$("#Data_MemberName").val(""),$("#Input_Member_Email").val(""),$("#Input_Member_Email_value").val(""),onClearMemberData(),e&&onShowViewNewCheckInDefault(t)}function onHideCheckInAdd(){$("#successCheckInAddAlert").hide(),$("#errorCheckInAddAlert").hide(),$("#errorCheckInAddContent").html("An error occurred while processing your request."),$("#warningCheckInAddAlert").hide(),$("#btnSaveCheckInAdd").hide(),$("#btnCancelCheckInAdd").hide(),$("#btnCloseCheckInAdd").hide(),$("#btnSaveACheckInAdd").hide()}function onCloseShowCheckInAdd(){$("#btnSaveACheckInAdd").hide(),$("#btnSaveCheckInAdd").hide(),$("#btnCancelCheckInAdd").hide(),$("#btnCloseCheckInAdd").fadeIn()}function onSaveShowCheckInAdd(){$("#btnSaveCheckInAdd").fadeIn(),$("#btnCancelCheckInAdd").fadeIn(),$("#btnCloseCheckInAdd").hide(),$("#btnSaveACheckInAdd").hide()}function onSaveShowACheckInAdd(){$("#btnSaveCheckInAdd").hide(),$("#btnCancelCheckInAdd").fadeIn(),$("#btnCloseCheckInAdd").hide(),$("#btnSaveACheckInAdd").fadeIn()}function onCloseCheckInAdd(){onCancelCheckInAdd(),onEnabledCheckInAdd(),$("#formCheckInAdd").fadeIn(),$("#btnCloseCheckInAdd").hide(),$("#btnSaveCheckInAdd").fadeIn(),$("#btnCancelCheckInAdd").fadeIn()}function onEnabledCheckInAdd(){$("#filterCheckInAdd").removeAttr("disabled"),$("#Data_MemberNumber").removeAttr("disabled"),$("#Data_MemberNumber_value").removeAttr("disabled"),$("#Data_RoomNumber").removeAttr("disabled"),$("#Data_CheckInDate").removeAttr("disabled"),$("#Data_CheckOutDate").removeAttr("disabled"),$("#Input_Member_Email").removeAttr("disabled"),$("#Input_Member_Email_value").removeAttr("disabled"),$("#Data_BookingMethod").removeAttr("disabled")}function onSaveCheckInAdd(){MemberNumber=$("#Data_MemberNumber").val(),onHideCheckInAdd(),$("#formCheckInAdd").hide(),$("#warningCheckInAddAlert").fadeIn();var e=$("#Data_CheckInCode").val(),a=2;""!=e&&(a=3);var t=apiServer+"/api/hotel",n={requestType:a,userid:userId,CheckInData:{HotelName:$("#filterCheckInAdd option:selected").text(),CheckInCode:e,MemberNumber:MemberNumber,HotelId:$("#filterCheckInAdd").val(),CheckInDate:$("#Data_CheckInDate").val(),CheckOutDate:$("#Data_CheckOutDate").val(),BookingMethodId:parseInt($("#Data_BookingMethod").val()),RoomNumber:$("#Data_RoomNumber").val()}};$.ajax({url:t,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#warningCheckInAddAlert").hide(),null!=e&&0==e.code?(onCloseShowCheckInAdd(),$("#successCheckInAddAlert").fadeIn(),onViewCheckInDefaultList($("#filterCheckInDefaultList").val())):(onSaveShowCheckInAdd(),null!=e&&null!=e.message&&""!=e.message&&$("#errorCheckInAddContent").html(e.message),$("#errorCheckInAddAlert").fadeIn(),$("#formCheckInAdd").fadeIn())},error:function(e){$("#btnSaveCheckInAdd").removeAttr("disabled"),$("#btnCancelCheckInAdd").removeAttr("disabled"),$("#btnCloseCheckInAdd").hide(),$("#warningCheckInAddAlert").hide(),$("#errorCheckInAddAlert").fadeIn(),$("#formCheckInAdd").fadeIn()}})}function showCheckInDataCheckInAdd(e){null!=e&&($("#Data_CheckInCode").val(e.CheckInCode),$("#Data_HotelId").val(e.HotelId),$("#filterCheckInAdd").val(e.HotelId),$("#Data_MemberNumber").val(e.MemberNumber),$("#Data_MemberName").val(e.MemberName),$("#Data_BookingMethod").val(e.BookingMethodId),$("#Data_RoomNumber").val(e.RoomNumber),$("#Data_CheckInDate").val(e.CheckInDate.substring(0,10)),$("#Data_CheckOutDate").val(e.CheckOutDate.substring(0,10)))}function showPersonalDataCheckInAdd(e){if(null!=e&&void 0!=e){if(e.MemberNumber.length>0?$("#nonmemberdiv").hide():$("#nonmemberdiv").show(),$("#Data_MemberNumber").val(e.MemberNumber),$("#Data_MemberNumber_value").val(e.MemberNumber),$("#Data_Member_MemberType").html(e.MemberType),$("#Data_Member_Number").html(e.MemberNumber),""!=e.InsertDate&&$("#Data_Member_JoinDate").html(moment(e.InsertDate).format("ll")),$("#Input_Member_Email").val(e.EmailAddress),$("#Input_Member_Email_value").val(e.EmailAddress),$("#Data_MemberName").val(e.FullName),""!=e.Gender&&$("#Data_Gender").html(void 0===e.Gender?"":"M"===e.Gender.trim()||"m"===e.Gender.trim()?"Male":"Female"),$("#Data_Telephone").html(e.TelephoneNumber),$("#Data_Email").html(e.EmailAddress),$("#Data_Country").html(e.HomeCountry),$("#Data_City").html(e.HomeCity),$("#Data_Custom").html(e.CustomPreference),null!=e.Preferences){var a="";e.Preferences.forEach(function(e){var t="";e.IsChecked&&(t="checked"),a+='<div class="col-lg-12 small"><input type="checkbox" '+t+" disabled> "+e.Text+"</div>"}),$("#Data_Preferences").html(a)}if(null!=e.PreferenceChecks){var a="";e.PreferenceChecks.forEach(function(e){var t="";e.IsChecked&&(t="checked"),a+='<div class="col-lg-12 small"><input type="checkbox" '+t+" disabled> "+e.Text+"</div>"}),$("#Data_Options").html(a)}if(null!=e.PreferencePriorities){var a="";e.PreferencePriorities.forEach(function(e){a+='<div class="col-lg-12 small">'+e.PriorityNumber+". "+e.Text+"</div>"}),$("#Data_Priorities").html(a)}if(null!=e.FavoriteDestinations){var a="";e.FavoriteDestinations.forEach(function(e){a+='<div class="col-lg-12 small">'+e.DisplayText+"</div>"}),$("#Data_Favorites").html(a)}}}function showCheckInOutDateACheckInAdd(e){null!=e&&($("#Data_CheckInDate").val(e.CheckInDate),$("#Data_CheckOutDate").val(e.CheckOutDate))}function onChangeCardNumberCheckInAdd(){onClearMemberData();var e=WebApp.GetCheckInScope();$("#Data_MemberName").css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"});var a=e.CheckInBy,t=$("#Data_MemberNumber").val();"email"==a&&(t=$("#Input_Member_Email").val());var n=apiServer+"/api/hotel/GetMemberData",r={searchBy:a,searchValue:t};$.ajax({url:n,type:"GET",data:r,dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){if($("#Data_MemberName").css({"background-repeat":"","background-image":"none","background-position":""}),null!=e){var a=WebApp.GetCheckInScope(),n=null;null!=e.MemberNumber&&e.MemberNumber.length>2&&(n=e),a.$apply(function(){a.NewMember.Email=t,a.SelectedMemberCheckIn={Data:{},Personal:n}}),showPersonalDataCheckInAdd(e),null==n&&WebApp.ShowNonMemberCheckInForm(!0)}},error:function(e){$("#Data_MemberName").css({"background-repeat":"","background-image":"none","background-position":""}),onClearMemberData()}})}function onChangeCardNumberCheckInAdd(e){onClearMemberData();var a=WebApp.GetCheckInScope();$("#Data_MemberName").css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"});var t=a.CheckInBy,n=e;"email"==t&&(n=e);var r=apiServer+"/api/hotel/GetMemberData",c={searchBy:t,searchValue:n};$.ajax({url:r,type:"GET",data:c,dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){if($("#Data_MemberName").css({"background-repeat":"","background-image":"none","background-position":""}),null!=e){var a=WebApp.GetCheckInScope(),t=null;null!=e.MemberNumber&&e.MemberNumber.length>2&&(t=e),a.$apply(function(){a.NewMember.Email=n,a.SelectedMemberCheckIn={Data:{},Personal:t}}),showPersonalDataCheckInAdd(e),null==t&&WebApp.ShowNonMemberCheckInForm(!0)}},error:function(e){$("#Data_MemberName").css({"background-repeat":"","background-image":"none","background-position":""}),onClearMemberData()}})}function onShowViewNewCheckInDefault(e){+$("#panelCheckInAdd").css({"min-height":"100px","background-repeat":"no-repeat","background-image":"url('//cdn0.astondata.com/images/ajaxloader00_21643.gif')","background-position":"center"}),onHideCheckInAdd(),$("#filterCheckInAdd").attr("disabled","disabled"),$("#Data_MemberNumber").attr("disabled","disabled"),$("#Input_Member_Email").attr("disabled","disabled"),$("#Data_RoomNumber").attr("disabled","disabled"),$("#Data_CheckInDate").attr("disabled","disabled"),$("#Data_CheckOutDate").attr("disabled","disabled"),$("#Data_BookingMethod").attr("disabled","disabled");var a=apiServer+"/api/hotel",t={requestType:232,userid:userId,name:"checkincode",value:e};$.ajax({url:a,type:"post",data:JSON.stringify(t),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){onClearMemberData();var a=WebApp.GetCheckInScope();a.$apply(function(){a.SelectedMemberCheckIn=e}),$("#titleCheckInAdd").html("View Check-In"),$("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),null!=e&&0==e.code?(showCheckInDataCheckInAdd(e.Data),showPersonalDataCheckInAdd(e.Personal),onCloseShowCheckInAdd()):onEnabledCheckInAdd()},error:function(e){$("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),onEnabledCheckInAdd()}})}function onShowEditNewCheckInDefault(e){$("#panelCheckInAdd").css({"min-height":"100px","background-repeat":"no-repeat","background-image":"url('//cdn0.astondata.com/images/ajaxloader00_21643.gif')","background-position":"center"}),onHideCheckInAdd(),onEnabledCheckInAdd(),$("#filterCheckInAdd").attr("disabled","disabled"),$("#Data_MemberNumber").attr("disabled","disabled"),$("#Input_Member_Email").attr("disabled","disabled"),$("#Data_MemberNumber_value").attr("disabled","disabled"),$("#Input_Member_Email_value").attr("disabled","disabled");var a=apiServer+"/api/hotel",t={requestType:232,userid:userId,name:"checkincode",value:e};$.ajax({url:a,type:"post",data:JSON.stringify(t),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){onClearMemberData();var a=WebApp.GetCheckInScope();a.$apply(function(){a.SelectedMemberCheckIn=e}),$("#titleCheckInAdd").html("Edit Check-In"),$("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),null!=e&&0==e.code?(showCheckInDataCheckInAdd(e.Data),showPersonalDataCheckInAdd(e.Personal),onSaveShowCheckInAdd()):onEnabledCheckInAdd()},error:function(e){$("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),onEnabledCheckInAdd()}})}function onShowEditNewCheckInADefault(e,a,t){if(null!=e){onHideCheckInAdd(),onEnabledCheckInAdd(),$("#panelCheckInAdd").css({"min-height":"100px","background-repeat":"no-repeat","background-image":"url('//cdn0.astondata.com/images/ajaxloader00_21643.gif')","background-position":"center"}),$("#filterCheckInAdd").attr("disabled","disabled"),$("#Data_MemberNumber").attr("disabled","disabled");var n=$("#anm"+e).html();if($("#filterCheckInAdd").val(t),$("#Data_MemberNumber").val(e),$("#Data_MemberName").val(n),14==e.length){var r=apiServer+"/api/hotel",c={requestType:274,userid:userId,name:a,value:e};$.ajax({url:r,type:"post",data:JSON.stringify(c),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){null!=e&&showCheckInOutDateACheckInAdd(e)}});var r=apiServer+"/api/hotel",o={requestType:21,userid:userId,name:"cardnumber",value:e};$.ajax({url:r,type:"post",data:JSON.stringify(o),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),null!=e?(showPersonalDataCheckInAdd(e),onSaveShowACheckInAdd()):onCloseShowCheckInAdd()},error:function(e){$("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),onCloseShowCheckInAdd()}})}else $("#panelCheckInAdd").css({"background-repeat":"","background-image":"none","background-position":""}),onCloseShowCheckInAdd();$("#Data_RoomNumber").focus()}}function onSaveACheckInAdd(){if(MemberNumber=$("#Data_MemberNumber").val(),""==MemberNumber)return $("#errorCheckInAddContent").html("Unknown Member Number. Cannot Continue"),void $("#errorCheckInAddAlert").fadeIn();onHideCheckInAdd(),$("#formCheckInAdd").hide(),$("#warningCheckInAddAlert").fadeIn();var e=$("#Data_CheckInCode").val(),a=273;""!=e&&(a=279);var t=apiServer+"/api/hotel",n={requestType:a,userid:userId,CheckInData:{CheckInCode:e,MemberNumber:MemberNumber,HotelId:$("#filterCheckInAdd").val(),CheckInDate:$("#Data_CheckInDate").val(),CheckOutDate:$("#Data_CheckOutDate").val(),RoomNumber:$("#Data_RoomNumber").val()}};$.ajax({url:t,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#warningCheckInAddAlert").hide(),null!=e&&0==e.code?(onCloseShowCheckInAdd(),$("#successCheckInAddAlert").fadeIn(),onOptionSelectChangeCheckInDefault()):(onSaveShowCheckInAdd(),null!=e&&null!=e.message&&""!=e.message&&$("#errorCheckInAddContent").html(e.message),$("#errorCheckInAddAlert").fadeIn(),$("#formCheckInAdd").fadeIn())},error:function(e){$("#btnSaveCheckInAdd").removeAttr("disabled"),$("#btnCancelCheckInAdd").removeAttr("disabled"),$("#btnCloseCheckInAdd").hide(),$("#warningCheckInAddAlert").hide(),$("#errorCheckInAddAlert").fadeIn(),$("#formCheckInAdd").fadeIn()}})}function onResizeChat(){$(window).resize(function(){$("#chat-member-row").css("height",.75*window.innerHeight),$("#chat-member-list").css("height",$("#chat-member-row").height()),$("#chat-member-conf").css("height",$("#chat-member-row").height()),$("#chat-member-conf-group").css("height",$("#chat-member-row").height()-70)}).trigger("resize")}function onHideCheckOutAlertCheckIn(){$("#successCheckOutAlert").hide(),$("#warningCheckOutAlert").hide(),$("#errorCheckOutAlert").hide()}function onShowOKCheckOutAlertCheckIn(){$("#btnOKCheckOutAlert").show(),$("#btnCloseCheckOutAlert").show(),$("#btnDoneCheckOutAlert").hide()}function onHideOKCheckOutAlertCheckIn(){$("#btnOKCheckOutAlert").hide(),$("#btnCloseCheckOutAlert").hide(),$("#btnDoneCheckOutAlert").hide()}function onShowCheckOutModalCheckIn(e,a,t,n){checkOutCheckInCodeProcess=a,checkOutHotelIdProcess=e,onHideCheckOutAlertCheckIn(),onShowOKCheckOutAlertCheckIn(),null!=n&&($("#CheckOut_MemberName").html(n.MemberName),$("#CheckOut_MemberNumber").html(n.MemberNumber),$("#CheckOut_Duration").html(n.CheckInString+" to "+n.CheckOutString),$("#CheckOut_Room").html(n.RoomNumber),$("#divCheckOutAlertContainer").modal())}function onOKCheckOutAlert(){if(""!=checkOutCheckInCodeProcess){onHideCheckOutAlertCheckIn(),onHideOKCheckOutAlertCheckIn(),$("#warningCheckOutAlert").fadeIn();var e=apiServer+"/api/hotel",a={requestType:4,userid:userId,name:checkOutHotelIdProcess,CheckInCode:checkOutCheckInCodeProcess};$.ajax({url:e,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#warningCheckOutAlert").hide(),null!=e&&0==e.code?($("#btnDoneCheckOutAlert").fadeIn(),$("#successCheckOutAlert").fadeIn()):(onShowOKCheckOutAlertCheckIn(),null!=e&&null!=e.message&&""!=e.message&&$("#errorCheckOutAlert").html(e.message),$("#errorCheckOutAlert").fadeIn())},error:function(e){onShowOKCheckOutAlertCheckIn(),$("#warningCheckOutAlert").hide(),$("#errorCheckOutAlert").fadeIn()}})}}function setChatMessageAsRead(e){}function setChatGuestList(e){void 0===e&&(e=[]),console.log("Guest List Member Count: "+e.length),null!=e&&e.length>0?($("#chat-member-list-group").html(""),$.each(e,function(){var e="";g_selectedMemberNumber==this.MemberID&&(e=" active");var a="";this.NewMessageCount>0&&(a=this.NewMessageCount),$("#chat-member-list-group").append('<a href="#" onclick="onSelectChatMember(\''+this.MemberID.replace(".","-dot-").replace("@","-at-")+'\')" class="list-group-item"'+e+' id="gItem'+this.MemberID.replace(".","-dot-").replace("@","-at-")+'"><span class="badge" id="gBadge'+this.MemberID.replace(".","-dot-").replace("@","-at-")+'">'+a+'</span><p class="list-group-item-heading" id="gFName'+this.MemberID.replace(".","-dot-").replace("@","-at-")+'">'+this.Name+'</p><p class="list-group-item-text small" id="gCico'+this.MemberID.replace(".","-dot-").replace("@","-at-")+'">'+this.CheckIn+" - "+this.CheckOut+", Room: "+this.Room+"</p></a>")})):$("#chat-member-list-group").html('<span class="label label-info" id="gItemEmpty">No Check-In Guest Found</span>')}function updateChatGuestList(e){console.log("Member Update Count: "+e.length),null!=e&&e.length>0?$.each(e,function(){if(this.IsDeleted){var e=$("#gItem"+this.MemberNumber);e.fadeOut(100,function(){e.remove()}),""==$("#chat-member-list-group").html()&&$("#chat-member-list-group").html('<span class="label label-info" id="gItemEmpty">No Check-In Guest Found</span>'),g_selectedMemberNumber==this.MemberNumber&&$("#chat-member-conf-group").html("")}else if(this.IsUpdated){var a=null;if($("#gItemEmpty").length?$("#gItemEmpty").remove():$("#gItem"+this.MemberNumber).length&&(a=$("#gItem"+this.MemberNumber)),null==a){var t="";g_selectedMemberNumber==this.MemberNumber&&(t=" active");var n="";this.NewMessageCount>0&&(n=this.NewMessageCount),$("#chat-member-list-group").prepend('<a href="#" onclick="onSelectChatMember(\''+this.MemberNumber+'\')" class="list-group-item"'+t+' id="gItem'+this.MemberNumber+'"><span class="badge" id="gBadge'+this.MemberNumber+'">'+n+'</span><p class="list-group-item-heading" id="gFName'+this.MemberNumber+'">'+this.MemberName+'</p><p class="list-group-item-text small" id="gCico'+this.MemberNumber+'">'+this.CheckInDate+" - "+this.CheckOutDate+", Room: "+this.RoomNumber+"</p></a>")}else this.NewMessageCount>0?$("#gBadge"+this.MemberNumber).html(this.NewMessageCount):$("#gBadge"+this.MemberNumber).html(""),$("#gFName"+this.MemberNumber).html(this.MemberName),$("#gCico"+this.MemberNumber).html(this.CheckInDate+" - "+this.CheckOutDate+", Room: "+this.RoomNumber),$("#chat-member-list-group").prepend(a.hide().fadeIn())}}):$("#chat-member-list-group").html('<span class="label label-info">No Check-In Guest Found</span>')}function onOptionSelectChatHotel(){var e=$("#filterChat").val();null!=e&&""!=e&&($("#chat-member-list-group").html(""),$("#chat-topic-head").html(""),$("#chat-topic-subhead").html(""),$("#chat-member-conf-group").html(""),g_selectedMemberNumber="",$("#chat-member-send").attr("disabled","disabled"),$("#chat-member-text").attr("disabled","disabled"),$("#chat-member-list-group").html('<span class="label label-mute">Downloading Check-In Guest list...</span>'),$("#chat-member-list").css({"background-image":"url('//cdn0.astondata.com/images/ajaxloader-00.gif')","background-repeat":"no-repeat","background-position":"center"}),$.connection.hub.start().done(function(){var a=$.connection.buttlerGuestServer;null!=g_selectedHotelId&&""!=g_selectedHotelId&&a.server.removeFromBroadcastList(g_selectedHotelId).done(function(){g_selectedHotelId=""}).fail(function(){console.log("Unsub hotel "+g_selectedHotelId+" failed!")}),$.connection.ChatHub.server.getActiveMember($("#filterChat").val()).done(function(){g_selectedHotelId=e}).fail(function(){console.log("failed getting new user list")})}).fail(function(){$("#chat-member-list-group").html('<span class="label label-warning">Unable to connect to server.</span>')}))}function onSelectChatMember(e){null!=e&&""!=e&&(""!=g_selectedMemberNumber&&$("#gItem"+g_selectedMemberNumber).attr("class","list-group-item"),$("#gItem"+e).attr("class","list-group-item active"),$("#chat-topic-head").html($("#gFName"+e).html()),$("#chat-topic-subhead").html($("#gCico"+e).html()),$("#chat-member-conf-group").html(""),g_selectedMemberNumber=e,$("#chat-member-conf-group").html('<span class="label label-info">Downloading selected member chat messages...</span>'),$("#chat-member-conf-group").css({"background-image":"url('//cdn0.astondata.com/images/ajaxloader-00.gif')","background-repeat":"no-repeat","background-position":"center"}),GetChatHistory(),$("#chat-member-send").removeAttr("disabled"),$("#chat-member-text").removeAttr("disabled"))}function notifyUser(e){g_oldtitle=document.title,intv=window.setInterval(function(){document.title=document.title===e?g_oldtitle:e},500),soundManager.onready(function(){soundManager.play("beepSound")}),window.onfocus=function(){window.clearInterval(intv),document.title=g_oldtitle}}function updateChatMessage(e){console.log("New Messages Count: "+e.length);var a=$("#gItem"+g_selectedMemberNumber);if(null!=e&&e.length>0&&null!=a){var t=parseInt($("#gBadge"+g_selectedMemberNumber).html());(null==t||isNaN(t))&&(t=0),$("#spanUnreadRow").length||$("#chat-member-conf-group").append('<div class="row-fluid" id="chatUnreadRow"><span class="bubble-row-unread"><span class="bubble-date-text" id="spanUnreadRow"></span></span></div>'),$.each(e,function(){t++,g_lastDate!=this.MessageDate&&($("#chat-member-conf-group").append('<div class="row-fluid"><span class="bubble-row-center"><span class="bubble-date-text">'+this.MessageDate+"</span></span></div>"),g_lastDate=this.MessageDate),bubbleId="bubble"+this.MessageId,this.IsMember?chatItem='<div class="row-fluid" id="'+bubbleId+'"><div class="bubble-right">'+this.Message+'<div class="extra-info"><span class="extra-date">'+this.MessageTime+"</span></div></div></div>":chatItem='<div class="row-fluid" id="'+bubbleId+'"><div class="bubble-left">'+this.Message+'<div class="extra-info">'+this.AdminName+'<span class="extra-date">'+this.MessageTime+"</span></div></div></div>",$("#chat-member-conf-group").append(chatItem)}),$("#gBadge"+g_selectedMemberNumber).html(t),oldItem=$("#gItem"+g_selectedMemberNumber),$("#chat-member-list-group").prepend(oldItem.hide().fadeIn()),$("#spanUnreadRow").html(t+" Unread Messages"),$("#chat-member-conf-group").scrollTo("#chatUnreadRow"),notifyUser(t+" Unread Messages")}else null!=g_selectedMemberNumber&&""!=g_selectedMemberNumber&&($.connection.hub.start().done(function(){var e=$.connection.buttlerMessageServer;e.server.removeFromBroadcastList(g_selectedMemberNumber)}),g_selectedMemberNumber="")}function sendChatMessage(){var e=$("#chat-member-text").val(),a=1,t=$("#isbroadcast").is(":checked");t&&(a=2);var n=g_selectedMemberNumber.replace("-at-","@").replace("-dot-","."),r=$("#filterChat").val(),c=1,o=$("#hdnName").val(),s=Date.now()/1e3|0;$.connection.ChatHub.server.publish(n,r,c,e,o,a,s),$("#message").val("").focus()}function rewriteChatMessage(e){if($("#chat-member-conf-group").html(""),$("#chat-member-conf-group").css({"background-image":"none"}),null!=e&&e.length>0){var a="",t="",n="",r=0;$.each(e,function(){this.IsRead||(setChatMessageAsRead(this.MessageId),""==t?(t="chatUnreadRow",$("#chat-member-conf-group").append('<div class="row-fluid" id="chatUnreadRow"><span class="bubble-row-unread"><span class="bubble-date-text" id="spanUnreadRow">Unread Messages</span></span></div>'),r=1):r++),a!=this.MessageDate&&($("#chat-member-conf-group").append('<div class="row-fluid"><span class="bubble-row-center"><span class="bubble-date-text">'+this.MessageDate+"</span></span></div>"),a=this.MessageDate),insertChatBubble(this)}),$("#chat-member-conf-group").scrollTo(0),""==t?$("#chat-member-conf-group").scrollTo("#"+n):($("#chat-member-conf-group").scrollTo("#"+t),$("#spanUnreadRow").html(r+" Unread Messages")),g_lastDate=a}}function GetChatHistory(){var e={MemberID:g_selectedMemberNumber.replace("-at-","@").replace("-dot-","."),HotelID:$("#filterChat").val(),TakeRow:100,SkipRow:0};$.connection.ChatHub.server.getChat(e)}function setAsRead(){$("#chatUnreadRow").length&&$.connection.hub.start().done(function(){var e=$.connection.buttlerMessageServer;e.server.setAllRead(g_selectedHotelId,g_selectedMemberNumber),$("#chatUnreadRow").length&&$("#chatUnreadRow").fadeOut(100,function(){$("#chatUnreadRow").remove()})})}function getCurrentURL(){return $(location).attr("pathname")}function insertChatBubble(e){var a=e.Message;bubbleId="bubble"+e.MessageId;var t=$("#hdnName").val();a=t===e.Sender?'<div class="row-fluid" id="'+bubbleId+'"><div class="bubble-right">'+e.Message+'<div class="extra-info"><span class="extra-date">'+e.ChatTime+"</span></div></div></div>":'<div class="row-fluid" id="'+bubbleId+'"><div class="bubble-left">'+e.Message+'<div class="extra-info">'+e.Sender.replace("-at-","@").replace("-dot-",".")+'<span class="extra-date">'+e.ChatTime+"</span></div></div></div>",$("#chat-member-conf-group").append(a)}function updateSNSChatMessage(e){var a=$("#gItem"+g_selectedMemberNumber);if(null!=e&&null!=a){var t=parseInt($("#gBadge"+g_selectedMemberNumber).html());(null==t||isNaN(t))&&(t=0),$("#spanUnreadRow").length||$("#chat-member-conf-group").append('<div class="row-fluid" id="chatUnreadRow"><span class="bubble-row-unread"><span class="bubble-date-text" id="spanUnreadRow"></span></span></div>'),t++,g_lastDate!=this.ChatTime&&($("#chat-member-conf-group").append('<div class="row-fluid"><span class="bubble-row-center"><span class="bubble-date-text">'+this.ChatTime+"</span></span></div>"),g_lastDate=this.ChatTime),insertChatBubble(e),$("#gBadge"+g_selectedMemberNumber).html(t),oldItem=$("#gItem"+g_selectedMemberNumber),$("#chat-member-list-group").prepend(oldItem.hide().fadeIn()),$("#spanUnreadRow").html(t+" Unread Messages"),$("#chat-member-conf-group").scrollTo("#chatUnreadRow"),notifyUser(t+" Unread Messages")}else null!=g_selectedMemberNumber&&""!=g_selectedMemberNumber&&($.connection.hub.start().done(function(){var e=$.connection.buttlerMessageServer;e.server.removeFromBroadcastList(g_selectedMemberNumber)}),g_selectedMemberNumber="")}function onViewCheckinRequestApprovalDefaultList(e){var a=WebApp.GetScope("divCheckinRequestApprovalDefaultList"),t={HotelId:e};void 0==e&&(t.hid=null);var n=apiServer+"/api/CheckinRequest/GetList";$.ajax({url:n,type:"post",dataType:"json",data:JSON.stringify(t),async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){a.$apply(function(){a.CheckinRequestApprovalList=t.checkinRequest,a.SelectedHotel=e})},error:function(e){$("#divCheckinRequestApprovalDefaultListContainer").css({"background-image":"none"}).html("").append("No checkin request found.").show()}})}function updateCheckinRequestApprovalList(){var e=$("#filterCheckinRequestApprovalDefaultList").val();""==e&&(e=null),onViewCheckinRequestApprovalDefaultList(e)}var checkOutCheckInCodeProcess="",checkOutHotelIdProcess="",g_selectedHotelId="",g_selectedMemberNumber="",g_lastDate="",g_oldtitle="",intv;
function FeedbackController(e,t,o,n,r){function l(t,o,n,r){return $(t).addClass("cellColor"),$("td",t).unbind("click"),$("td",t).bind("click",function(){e.$apply(function(){e.someClickHandler(o)})}),t}e.Process=function(t){e.SelectedRequest=t,e.ShowMemberEditor()},e.ShowMemberEditor=function(){e.IsIncluded=null,e.IsOwner=null,e.SelectedHotelMember=null,void 0!=e.SelectedOwnerMember&&(e.SelectedOwnerMember.HotelId="",e.SelectedOwnerMember.ReferenceId=""),$("#modalMemberEditor").modal("show")},e.HideMemberEditor=function(){$("#modalMemberEditor").modal("hide")},e.ConfirmApproval=function(t){var o="Checkin Request Approval";return"-1"===e.SelectedBookingMethod?void swal(o,"Please select Booking Method first","error"):void swal({title:o,text:"Approve "+t.MemberName+"'s request?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(o){o&&e.ProcessRequest(t,!0)})},e.RejectApproval=function(t){swal({title:"Checkin Request Rejection",text:"Reject "+t.MemberName+"'s request?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#DD6B55",confirmButtonText:"Reject",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(o){o&&e.ProcessRequest(t,!1)})},e.operator,e.ProcessRequest=function(t,n){var r=(n?"Approve":"Reject")+" Request";showPleaseWait();var l="CheckinRequest/ProcessRequest",i={processby:e.operator,requestId:t.RequestId,isApproved:n,BookingMethod:e.SelectedBookingMethod};o.CallService(l,i,function(t){if(0===t.data.code){swal(r,"Success!","success"),e.HideProcessModal();var o=$("#filterCheckInRequestDefaultList").val();""==o&&(o=null),e.GetCheckinRequestApproval(o)}else swal(r,"Process failed, "+t.data.message,"warning");hidePleaseWait()},function(e){swal(r,"Process failed","error"),hidePleaseWait()})},e.GetCheckinRequestApproval=function(t){var n="Checkin Request",r="CheckinRequest/GetList",l={HotelID:t};o.CallService(r,l,function(o){0==o.data.code?(e.CheckinRequestApprovalList=o.data.checkinRequest,e.SelectedHotel=t):swal(n,"Failed to load "+n+", "+o.data.message,"warning")},function(e){swal(n,"Failed to load "+n,"error")})},e.SaveMemberInfo=function(){var t="Save Member Data";swal({title:t,text:"Save member info changes?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(t){if(t){var o=null,n=null;void 0!=e.SelectedOwnerMember&&(o=e.SelectedOwnerMember.HotelId,n=e.SelectedOwnerMember.ReferenceId),e.UpdateMemberType(e.SelectedMember.Email,o,n,e.SelectedMember.MembershipType)}})},e.UpdateMemberType=function(t,n,r,l){var i="Update Member Type",a="Member/UpdateMemberType",c={Email:t,hotelId:n,MemberType:l,OwnerId:r};o.CallService(a,c,function(t){0===t.data.code?(swal(i,"Success!","success"),e.HideMemberEditor=function(){$("#modalMemberEditor").modal("hide")}):swal(i,t.message,"error")},function(e){swal(i,"Failed!","error")})},e.dtColumns=[r.newColumn("name","Name").withOption("name","name"),r.newColumn("hotelname","Hotel").withOption("name","hotelname"),r.newColumn("phone"," Phone").withOption("name","phone"),r.newColumn("email","Email").withOption("name","email"),r.newColumn("comment","Comment").withOption("name","comment")],e.dtOptions=n.newOptions().withOption("ajax",{dataSrc:"data",url:apiServer+"/WebGuest/GetMemberFeedback",type:"POST"}).withOption("rowCallback",l).withOption("processing",!0).withOption("serverSide",!0).withPaginationType("full_numbers").withDisplayLength(10).withOption("aaSorting",[0,"asc"]),e.someClickHandler=function(t){e.ShowMemberEditor(),e.SelectedMember=t},e.message=""}WebGuest.controller("FeedbackController",["$scope","$http","CallNetworkService","DTOptionsBuilder","DTColumnBuilder",FeedbackController]);
function onViewHotelOpenList(){$("#divHotelOpenListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblHotelOpenList").html("");var e=apiServer+"/api/hotel",t={requestType:450};$.ajax({url:e,type:"post",data:JSON.stringify(t),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divHotelOpenListContainer").css({"background-image":"none"}),$("#divtblHotelOpenList").html('<table class="table table-bordered" id="tblHotelOpenList"></table>');var t=$("#tblHotelOpenList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:e,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Hotel Open found."},aoColumns:[{mDataProp:"HotelName",sTitle:"Hotel Name"},{mDataProp:"BrandName",sTitle:"Brand"},{mDataProp:"City",sTitle:"City/Region"},{mDataProp:"Country",sTitle:"Country"},{mDataProp:"HotelId",sTitle:"Action",mRender:function(e,t,a){return null!=a.HotelId&&"00000000-0000-0000-0000-000000000000"!=a.HotelId?'<button type="submit" class="btn btn-default btn-xs" onclick="window.open(\'http://astondata.com/hoteldb/HotelView.aspx?HotelId='+a.HotelId+'\',\'_blank\');">View</button><button type="submit" class="btn btn-default btn-xs" onclick="onEditHotelOpen(\''+a.WebCode+"','"+a.HotelId+"');\">Edit</button>":'<button type="submit" class="btn btn-default btn-xs" onclick="onEditHotelOpen(\''+a.WebCode+"','"+a.HotelId+"');\">Edit</button>"}}],fnDrawCallback:function(){$("#tblHotelOpenList tbody td").css({"font-size":"12px"})}});t.columns().eq(0).each(function(e){$("input",t.column(e).footer()).on("keyup change",function(){t.column(e).search(this.value).draw()})}),$("#tblHotelOpenList tbody td").css({"font-size":"12px"}),$("#tblHotelOpenList_wrapper .row-fluid:eq(0)").remove(),$("#tblHotelOpenList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblHotelOpenList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblHotelOpenList_wrapper .row-fluid .span6").removeClass("span6")},error:function(e){$("#divHotelOpenListContainer").css({"background-image":"none"}).html("").append("No Hotel Open found.").show()}})}function onViewHotelUnopenList(){$("#divHotelUnopenListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblHotelUnopenList").html("");var e=apiServer+"/api/hotel",t={requestType:451};$.ajax({url:e,type:"post",data:JSON.stringify(t),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divHotelUnopenListContainer").css({"background-image":"none"}),$("#divtblHotelUnopenList").html('<table class="table table-bordered" id="tblHotelUnopenList"></table>');var t=$("#tblHotelUnopenList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:e,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[1,"desc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Hotel Unopened found."},aoColumns:[{mDataProp:"HotelName",sTitle:"Hotel Name"},{mDataProp:"BrandName",sTitle:"Brand"},{mDataProp:"City",sTitle:"City"},{mDataProp:"Country",sTitle:"Country"},{mDataProp:"HotelId",sTitle:"Action",mRender:function(e,t,a){return null!=a.HotelId&&"00000000-0000-0000-0000-000000000000"!=a.HotelId?'<button type="submit" class="btn btn-default btn-xs" onclick="window.open(\'http://astondata.com/hoteldb/HotelView.aspx?HotelId='+a.HotelId+'\',\'_blank\');">View</button><button type="submit" class="btn btn-default btn-xs" onclick="onEditHotelUnopen(\''+a.WebCode+"','"+a.HotelId+"');\">Activate</button>":'<button type="submit" class="btn btn-default btn-xs" onclick="onEditHotelUnopen(\''+a.WebCode+"','"+a.HotelId+"');\">Activate</button>"}}],fnDrawCallback:function(){$("#tblHotelUnopenList tbody td").css({"font-size":"12px"})}});t.columns().eq(0).each(function(e){$("input",t.column(e).footer()).on("keyup change",function(){t.column(e).search(this.value).draw()})}),$("#tblHotelUnopenList tbody td").css({"font-size":"12px"}),$("#tblHotelUnopenList_wrapper .row-fluid:eq(0)").remove(),$("#tblHotelUnopenList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblHotelUnopenList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblHotelUnopenList_wrapper .row-fluid .span6").removeClass("span6")},error:function(e){$("#divHotelUnopenListContainer").css({"background-image":"none"}).html("").append("No Unopen Hotel found.").show()}})}function onEditHotelOpen(e,t){location.href=apiServer+"/WebPreferences/HotelEdit/"+t}function onEditHotelUnopen(e,t){location.href=apiServer+"/WebPreferences/HotelActivate/"+e}function onOptionSelectChangeUnassignProperty(){var e=$("#selectUnassignProperty").val();if(""==e)return $("#Data_HotelId").val("00000000-0000-0000-0000-000000000000"),void $("#Data_HotelId").prop("readonly",!1);$("#selectUnassignProperty").css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$("#selectUnassignProperty").attr("disabled","disabled");var t=apiServer+"/api/hotel",a={requestType:452,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){0==e.code?($("#Data_HotelId").val(e.Data.HotelId),$("#Data_HotelId").prop("readonly",!0),$("#Data_HotelName").val(e.Data.HotelName),$("#Data_BrandId").val(e.Data.BrandId),$("#Data_StreetAddress").val(e.Data.StreetAddress),$("#Data_CountryISO2").val(e.Data.CountryISO2),onShowRegionList("#Data_RegionCode",e.Data.CountryISO2,e.Data.RegionCode),$("#Data_City").val(e.Data.City),$("#Data_PhoneNumber").val(e.Data.PhoneNumber),$("#Data_FaxNumber").val(e.Data.FaxNumber),$("#Data_EmailAddress").val(e.Data.EmailAddress),$("#Data_BookingUrl").val(e.Data.BookingUrl),$("#Data_VHPHotelID").val(e.Data.VHPHotelID),$("#Data_Latitude").val(e.Data.Latitude),$("#Data_Longitude").val(e.Data.Longitude),$("#Data_IsOpened").val(e.Data.IsOpened)):alert(e.message),$("#selectUnassignProperty").css({"background-repeat":"","background-image":"none","background-position":""}),$("#selectUnassignProperty").removeAttr("disabled")},error:function(e){$("#selectUnassignProperty").css({"background-repeat":"","background-image":"none","background-position":""}),$("#selectUnassignProperty").removeAttr("disabled"),$("#Data_HotelId").prop("readonly",!1)}})}function onDownloadHotelOpen(){var e=$("#inputEmail").val();if(!e)return void onDownloadHotelOpenError("Empty e-mail address");$("#inputEmail").css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$("#inputEmail").attr("disabled","disabled"),$("#sendEmail").attr("disabled","disabled"),$("#warningHotelInfoAlert").show(),$("#errorHotelInfoAlert").hide(),$("#successHotelInfoAlert").hide(),$("#btnCloseHotelInfoAlert").hide(),$("#divHotelInfoContainer").modal();var t=apiServer+"/api/hotel",a={requestType:453,name:userName,action:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#inputEmail").css({"background-repeat":"","background-image":"none","background-position":""}),$("#inputEmail").removeAttr("disabled"),$("#sendEmail").removeAttr("disabled"),null!=e?e.code<0?onDownloadHotelOpenError(e.message):($("#inputEmail").val(""),$("#warningHotelInfoAlert").hide(),$("#errorHotelInfoAlert").hide(),$("#successHotelInfoAlert").fadeIn(),$("#btnCloseHotelInfoAlert").fadeIn()):onDownloadHotelOpenError("An error occurred while processing your request.")},error:function(e){$("#inputEmail").css({"background-repeat":"","background-image":"none","background-position":""}),$("#inputEmail").removeAttr("disabled"),$("#sendEmail").removeAttr("disabled"),onDownloadHotelOpenError(null!=e?e.message:"An error occurred while processing your request.")}})}function onDownloadHotelOpenError(e){$("#errorHotelInfoAlert").text(e),$("#warningHotelInfoAlert").hide(),$("#errorHotelInfoAlert").fadeIn(),$("#successHotelInfoAlert").hide(),$("#btnCloseHotelInfoAlert").fadeIn(),$("#divHotelInfoContainer").modal()}function onViewBenefitDefaultList(e){$("#divBenefitDefaultListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblBenefitDefaultList").html("");var t=apiServer+"/api/hotel",a={requestType:480,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$("#divBenefitDefaultListContainer").css({"background-image":"none"}),$("#divtblBenefitDefaultList").html('<table class="table table-bordered" id="tblBenefitDefaultList"></table>'),$("#tblBenefitDefaultList").dataTable({bDestroy:!0,bRetrieve:!0,aaData:t,bPaginate:!1,bFilter:!1,bInfo:!1,iDisplayLength:10,aaSorting:[[1,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Hotel Benefits found."},aoColumns:[{mDataProp:"BenefitName",sTitle:"Benefit Name",sWidth:"40%",mRender:function(e,t,a){return null==a.ReBenefitName?a.BenefitName:a.BenefitName+"<br />[Replace: "+a.ReBenefitName+"]"}},{mDataProp:"RangeText",sTitle:"Benefit Type"},{mDataProp:"CalcName",sTitle:"Calculation Type"},{mDataProp:"StartValue",sTitle:"Start Value",mRender:function(e,t,a){return 0==a.CalcType?"":a.StartValue}},{mDataProp:"MaxValue",sTitle:"Max Value",mRender:function(e,t,a){return 2==a.CalcType?a.MaxValue:""}},{mDataProp:"SortOrder",sTitle:"Sort Order"},{mDataProp:"BenefitId",sTitle:"Action",mRender:function(t,a,n){return null!=e&&""!=e&&0==n.RangeType?"&nbsp;":'<button type="submit" class="btn btn-default btn-xs" onclick="onShowEditNewBenefitDefault(\''+n.BenefitId+"');\">Edit</button>"}}],fnDrawCallback:function(){$("#tblBenefitDefaultList tbody td").css({"font-size":"12px"})}}),$("#tblBenefitDefaultList tbody td").css({"font-size":"12px"}),$("#tblBenefitDefaultList_wrapper .row-fluid:eq(0)").remove(),$("#tblBenefitDefaultList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblBenefitDefaultList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblBenefitDefaultList_wrapper .row-fluid .span6").removeClass("span6")},error:function(e){$("#divBenefitDefaultListContainer").css({"background-image":"none"}).html("").append("No Hotel Benefit found.").show()}})}function onOptionSelectChangeBenefitDefault(){var e=$("#filterBenefitDefaultList").val();onViewBenefitDefaultList(e)}function onOptionSelectRangeType(e){var t="#ReBenefitId",a=$("#BenefitId").val(),n=$("#HotelId").val(),i=$("#RangeType").val();if(null==e&&(e=$(t).val()),$(t).empty(),$(t).append($("<option/>",{value:"",text:"None"})),null!=i||i>0){$(t).css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$(t).attr("disabled","disabled");var o=apiServer+"/api/hotel",l={requestType:481,name:n,value:i,action:a};$.ajax({url:o,type:"post",data:JSON.stringify(l),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(a){$(t).css({"background-repeat":"","background-image":"none","background-position":""}),$(t).removeAttr("disabled"),null!=a.Data&&$.each(a.Data,function(e,a){$(t).append($("<option/>",{value:a.Key,text:a.Value}))}),$(t).val(e)},error:function(e){$(t).css({"background-repeat":"","background-image":"none","background-position":""})}})}}function onOptionSelectBenefitType(){var e=$("#CalcType").val();0==e||null==e?($("#div_Data_StartValue").fadeOut(),$("#div_Data_MaxValue").fadeOut(),$("#div_Data_ProgressiveIntervalDayCount").fadeOut(),$("#div_Data_ProgressiveValue").fadeOut()):1==e?($("#div_Data_StartValue").fadeIn(),$("#div_Data_MaxValue").fadeOut(),$("#div_Data_ProgressiveIntervalDayCount").fadeOut(),$("#div_Data_ProgressiveValue").fadeOut()):2==e&&($("#div_Data_StartValue").fadeIn(),$("#div_Data_MaxValue").fadeIn(),$("#div_Data_ProgressiveIntervalDayCount").fadeIn(),$("#div_Data_ProgressiveValue").fadeIn())}function onShowAddNewBenefitDefault(){var e=$("#filterBenefitDefaultList").val();location.href=apiServer+"/WebPreferences/BenefitAdd/"+e}function onShowEditNewBenefitDefault(e){var t=$("#filterBenefitDefaultList").val();null!=t&&""!=t||(t="default"),location.href=apiServer+"/WebPreferences/BenefitEdit/"+t+"/"+e}function onViewWifiDefaultList(e){$("#divWifiDefaultListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"}),$("#divtblWifiDefaultList").html("");var t=apiServer+"/api/hotel",a={requestType:470,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divWifiDefaultListContainer").css({"background-image":"none"}),$("#divtblWifiDefaultList").html('<table class="table table-bordered" id="tblWifiDefaultList"></table>');var t=$("#tblWifiDefaultList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:e,bPaginate:!1,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Hotel Wifi found."},aoColumns:[{mDataProp:"BrandName",sTitle:"Brand"},{mDataProp:"StartDateString",sTitle:"Start Date"},{mDataProp:"EndDateString",sTitle:"End Date"},{mDataProp:"SSID",sTitle:"SSID"},{mDataProp:"Password",sTitle:"Password"},{mDataProp:"WifiID",sTitle:"Action",mRender:function(e,t,a){return'<button type="submit" class="btn btn-default btn-xs" onclick="onEditWifiDefaultList(\''+a.WifiID+"');\">Edit</button>"}}],fnDrawCallback:function(){$("#tblWifiDefaultList tbody td").css({"font-size":"12px"})}});t.columns().eq(0).each(function(e){$("input",t.column(e).footer()).on("keyup change",function(){t.column(e).search(this.value).draw()})}),$("#tblWifiDefaultList tbody td").css({"font-size":"12px"}),$("#tblWifiDefaultList_wrapper .row-fluid:eq(0)").remove(),$("#tblWifiDefaultList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblWifiDefaultList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblWifiDefaultList_wrapper .row-fluid .span6").removeClass("span6")},error:function(e){$("#divWifiDefaultListContainer").css({"background-image":"none"}).html("").append("No Hotel Wifi Data found.").show()}})}function onOptionSelectChangeWifiDefault(){var e=$("#filterWifiDefaultList").val();onViewWifiDefaultList(e)}function onShowAddNewWifiDefault(){var e=$("#filterWifiDefaultList").val();location.href=apiServer+"/WebPreferences/WifiAdd/"+e}function onEditWifiDefaultList(e){var t=$("#filterWifiDefaultList").val();null!=t&&""!=t||(t="default"),location.href=apiServer+"/WebPreferences/WifiEdit/"+t+"/"+e}function onDownloadWifi(){var e=$("#filterWifiDefaultList").val(),t=$("#inputEmail").val();if(!t)return void onDownloadWifiError("Empty e-mail address");$("#inputEmail").css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$("#inputEmail").attr("disabled","disabled"),$("#sendEmail").attr("disabled","disabled"),$("#warningWifiAlert").show(),$("#errorWifiAlert").hide(),$("#successWifiAlert").hide(),$("#btnCloseWifiAlert").hide(),$("#divWifiContainer").modal();var a=apiServer+"/api/hotel",n={requestType:471,name:userName,value:e,action:t};$.ajax({url:a,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#inputEmail").css({"background-repeat":"","background-image":"none","background-position":""}),$("#inputEmail").removeAttr("disabled"),$("#sendEmail").removeAttr("disabled"),e.code<0?onDownloadWifiError(e.message):($("#inputEmail").val(""),$("#warningWifiAlert").hide(),$("#errorWifiAlert").hide(),$("#successWifiAlert").fadeIn(),$("#btnCloseWifiAlert").fadeIn())},error:function(e){$("#inputEmail").css({"background-repeat":"","background-image":"none","background-position":""}),$("#inputEmail").removeAttr("disabled"),$("#sendEmail").removeAttr("disabled"),onDownloadWifiError(null!=e?e.message:"An error occurred while processing your request.")}})}function onDownloadWifiError(e){$("#errorWifiAlert").text(e),$("#warningWifiAlert").hide(),$("#errorWifiAlert").fadeIn(),$("#successWifiAlert").hide(),$("#btnCloseWifiAlert").fadeIn(),$("#divWifiContainer").modal()}function onShowCountryList(e,t){$(e).css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$(e).attr("disabled","disabled");var a=apiServer+"/api/hotel",n={requestType:46};$.ajax({url:a,type:"post",data:JSON.stringify(n),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(a){$(e).css({"background-repeat":"","background-image":"none","background-position":""}),$(e).removeAttr("disabled");var n=$(e);n.empty(),n.append($("<option/>",{value:"",text:"-- Select a Country --"})),null!=a.Data&&($.each(a.Data,function(e,t){n.append($("<option/>",{value:t.CountryISO2,text:t.CountryName}))}),null!=t&&$(e).val(t))},error:function(t){$(e).css({"background-repeat":"","background-image":"none","background-position":""})}})}function onSelectCountryList(e,t,a,n){var i=$(e).val();onShowRegionList(t,i,n);var o=$(a);o.empty(),o.append($("<option/>",{value:"",text:"-- Select a city --"}))}function onShowRegionList(e,t,a){$(e).css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$(e).attr("disabled","disabled");var n=apiServer+"/api/hotel",i={requestType:460,value:t};$.ajax({url:n,type:"post",data:JSON.stringify(i),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$(e).css({"background-repeat":"","background-image":"none","background-position":""}),$(e).removeAttr("disabled");var n=$(e);n.empty(),n.append($("<option/>",{value:"",text:"-- Select a region --"})),null!=t.Data&&($.each(t.Data,function(e,t){n.append($("<option/>",{value:t.RegionCode,text:t.RegionName}))}),null!=a&&$(e).val(a))},error:function(t){$(e).css({"background-repeat":"","background-image":"none","background-position":""})}})}function onSelectRegionList(e,t,a,n){var i=$(e).val(),o=$(t).val();onShowCityList(a,i,o,n)}function onShowCityList(e,t,a,n){$(e).css({"background-repeat":"no-repeat","background-image":"url('"+apiServer+"/Content/img/icn_loading_animated.gif')","background-position":"center"}),$(e).attr("disabled","disabled");var i=apiServer+"/api/hotel",o={requestType:461,name:t,value:a};$.ajax({url:i,type:"post",data:JSON.stringify(o),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(t){$(e).css({"background-repeat":"","background-image":"none","background-position":""}),$(e).removeAttr("disabled");var a=$(e);a.empty(),a.append($("<option/>",{value:"",text:"-- Select a city --"})),null!=t.Data&&$.each(t.Data,function(e,t){a.append($("<option/>",{value:t.CityName,text:t.CityName}))})},error:function(t){$(e).css({"background-repeat":"","background-image":"none","background-position":""})}}),null!=n&&$(e).val(n)}function onViewImgGalleryListAll(){$("#divImgGalleryListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"});var e=apiServer+"/api/hotel",t={requestType:49,value:userId};$.ajax({url:e,type:"post",data:JSON.stringify(t),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divImgGalleryListContainer").css({"background-image":"none"}),$("#divImgGalleryListContainer").html('<div class="form-horizontal"><fieldset><div id="divtblImgGalleryList"><table class="table table-bordered" id="tblImgGalleryList"></table></div></fieldset></div>');var t=$("#tblImgGalleryList").DataTable({bDestroy:!0,bRetrieve:!0,aaData:e.Data,bPaginate:!0,bFilter:!0,bInfo:!1,iDisplayLength:10,aaSorting:[[0,"asc"]],oLanguage:{sInfoEmpty:"",sEmptyTable:"No Image Assets found."},aoColumns:[{mDataProp:"HotelName",sTitle:"Hotel Name",sWidth:"60%"},{mDataProp:"ImageCount",sTitle:"Image Number",sWidth:"15%"},{mDataProp:"ImageCountDel",sTitle:"Deleted Image",sWidth:"15%"},{mDataProp:"HotelId",sTitle:"Action",sWidth:"10%",mRender:function(e,t,a){return'<button type="submit" class="btn btn-default btn-xs" onclick="onSelectImgGalleryListAll(\''+a.HotelId+"');\">View</button>"}}],fnDrawCallback:function(){$("#tblImgGalleryList tbody td").css({"font-size":"12px"})}});t.columns().eq(0).each(function(e){$("input",t.column(e).footer()).on("keyup change",function(){t.column(e).search(this.value).draw()})}),$("#tblImgGalleryList tbody td").css({"font-size":"12px"}),$("#tblImgGalleryList_wrapper .row-fluid:eq(0)").remove(),$("#tblImgGalleryList_wrapper .row-fluid .span6:eq(0)").addClass("span4"),$("#tblImgGalleryList_wrapper .row-fluid .span6:eq(1)").addClass("span8"),$("#tblImgGalleryList_wrapper .row-fluid .span6").removeClass("span6")},error:function(e){$("#divImgGalleryListContainer").css({"background-image":"none"}).html("").append("No Image Assets found.").show()}})}function onSelectImgGalleryListAll(e){$("#filterImgGalleryList").val(e),onViewImgGalleryList(selectHotel)}function onViewImgGalleryList(e){$("#divImgGalleryListContainer").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"});var t=apiServer+"/api/hotel",a={requestType:491,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divImgGalleryListContainer").css({"background-image":"none"});var t="",a=new Date;a.setHours(0,0,0,0),$.each(e.Data,function(e,n){var i='<span class="label label-danger">new</span>';a>n.DateOfInsertion&&(i=""),t+='<div class="col-lg-3 col-md-4 col-xs-6 thumb"><div class="thumbnail">'+n.ImageTitle+"&nbsp;"+i+'<a href="#" onclick="onShowAssetFull(\''+n.ImgId+'\');"><img class="img-responsive" src="'+n.ImageUrl+'" alt="'+n.ImageTitle+'" title="'+n.ImageTitle+'"></a></div></div>'}),$("#divImgGalleryListContainer").html(t)},error:function(e){$("#divImgGalleryListContainer").css({"background-image":"none"}).html("").append("No Image Assets found.").show()}})}function onOptionSelectChangeImgGallery(){var e=$("#filterImgGalleryList").val();null==e||""==e?onViewImgGalleryListAll():onViewImgGalleryList(e)}function onShowAssetFull(e){$("#imgTitle").html("Loading..."),$("#imgSubTitle").html(""),$("#imgAssetFull").attr("src",apiServer+"/Content/img/ajaxloader00_21643.gif"),$("#divImgGalleryViewImage").modal(),$("#imgAssetFull").css({"min-height":"100px","background-image":"url('"+apiServer+"/Content/img/ajaxloader00_21643.gif')"});var t=apiServer+"/api/hotel",a={requestType:492,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){null!=e?($("#imgId").val(e.Data.ImgId),$("#imgTitle").html(e.Data.ImageTitle),$("#imgSubTitle").html("Upload by "+e.Data.UserInsertionFullName+" at "+e.Data.DateOfInsertionString),$("#imgAssetFull").attr("src",e.Data.FullImageUrl)):$("#imgAssetFull").attr("src","")},error:function(e){$("#imgTitle").html("Unable to find the requested image"),$("#imgAssetFull").attr("src","")}})}function onShowDeleteImage(){$("#btnConfirmImgGalleryDelete").show(),$("#imgDeleteTitle").html("Confirm Delete?"),$("#divImgGalleryDeleteBody").html('<p class="text-info">Deleting this image will only mark it as deleted in database.</p>'),$("#btnCloseImgGalleryDelete").html("Cancel"),$("#divImgGalleryDelete").modal()}function onConfirmDeleteImage(){var e=$("#imgId").val();$("#imgDeleteTitle").html("Delete Request Result"),$("#divImgGalleryDeleteBody").html("Processing...");var t=apiServer+"/api/hotel",a={requestType:493,value:e};$.ajax({url:t,type:"post",data:JSON.stringify(a),dataType:"json",async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(e){$("#divImgGalleryDeleteBody").css({"background-image":"none"}),null!=e?0==e.code?(onOptionSelectChangeImgGallery(),$("#btnConfirmImgGalleryDelete").hide(),$("#btnCloseImgGalleryDelete").html("Close"),$("#divImgGalleryViewImage").modal("hide"),$("#divImgGalleryDeleteBody").html('<p class="text-success">'+$("#imgTitle").html()+" has been successfully deleted</p>")):$("#divImgGalleryDeleteBody").html('<p class="text-warning">Failed to process due to:'+e.message+"</p>"):$("#divImgGalleryDeleteBody").html('<p class="text-warning">Unable to process the request</p>')},error:function(e){$("#divImgGalleryDeleteBody").css({"background-image":"none"}),$("#divImgGalleryDeleteBody").html("Unable to process the request")}})}function onShowAddNewImgGallery(){var e=$("#filterImgGalleryList").val();location.href=apiServer+"/WebPreferences/ImageGalleryAdd/"+e}function onViewMeetingRoomDefaultList(e){var t=WebApp.GetScope("divMeetingRoomDefaultList"),a={HotelId:e};void 0==e&&(a.hotelId=null);var n=apiServer+"/api/MeetingRooms/GetMeetingRoom";$.ajax({url:n,type:"post",dataType:"json",data:JSON.stringify(a),async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(a){t.$apply(function(){t.MeetingRoomList=a.Rooms,void 0==e?t.SelectedHotel=null:t.SelectedHotel=e})},error:function(e){$("#divMeetingRoomDefaultListContainer").css({"background-image":"none"}).html("").append("No Meeting Room found.").show()}})}function updateMeetingRoomList(){var e=$("#filterCheckInDefaultList").val();""==e&&(e=null),onViewMeetingRoomDefaultList(e)}function updateHotelInfoList(){var e=$("#filterHotelDefaultList").val();""==e&&(e=null),onViewHotelListDefaultList(e)}function onViewHotelListDefaultList(e){var t=WebApp.GetScope("divHotelInfoDefaultList"),a={HotelId:e};void 0==e&&(a.hotelId=null);var n=apiServer+"/api/DataPoint/HotelInfo";$.ajax({url:n,type:"post",dataType:"json",data:JSON.stringify(a),async:!0,contentType:"application/json;charset=utf-8",cache:!1,success:function(a){t.$apply(function(){t.HotelInfoList=a.Properties,void 0==e?t.SelectedHotel=null:t.SelectedHotel=e})},error:function(e){$("#divHotelInfoDefaultListContainer").css({"background-image":"none"}).html("").append("No Hotel found.").show()}})}
function HotelInfoController(o,t,e,n){o.dtOptions=e.newOptions().withDOM('C<"clear">lfrtip').withOption("initComplete",function(){o.loading=!1}).withButtons(["columnsToggle","colvis","copy","print","excel",{text:"Some button",key:"1",action:function(o,t,e,n){alert("Button activated")}}]),o.dtColumnDefs=[n.newColumnDef(0).notSortable(),n.newColumnDef(1).notSortable(),n.newColumnDef(2).notSortable(),n.newColumnDef(3).notSortable(),n.newColumnDef(4).notSortable(),n.newColumnDef(5).notSortable()]}WebGuest.controller("HotelInfoController",["$scope","CallNetworkService","DTOptionsBuilder","DTColumnDefBuilder",HotelInfoController]);
function MeetingRoomController(e,o,t,i,n){e.editMode=!1,e.SelectedRoom,e.MeetingRoomList=[],e.SelectedHotel=null,e.SelectedEvent=null,e.ResetSelectedRoom=function(){e.SelectedRoom=null},e.AddEvent=function(t){var i="Event Schedule";showPleaseWait();var n="meetingrooms/AddMeetingSchedule",l={MeetingInfo:t};o.CallService(n,l,function(o){o.data.result?(t.MeetingRoomId=o.data.message,e.AddEventToList(t),swal(i,"Event successfully saved!","success"),e.HideEventEditor()):swal(i,"Failed to save event, "+o.data.message,"warning"),hidePleaseWait()},function(e){swal(i,"Failed to save event","error"),hidePleaseWait()})},e.UpdateEvent=function(t){var i="Event Schedule";showPleaseWait();var n="meetingrooms/UpdateMeetingSchedule",l={MeetingInfo:t};o.CallService(n,l,function(o){o.data.result?(swal(i,"Event successfully updated!","success"),e.HideEventEditor(),e.ViewSchedule(e.SelectedRoom)):swal(i,"Failed to update event, "+o.data.message,"warning"),hidePleaseWait()},function(e){swal(i,"Failed to update event","error"),hidePleaseWait()})},e.DeleteEvent=function(t){var i="Event Schedule",n="meetingrooms/DeleteMeetingSchedule",l={ScheduleId:t.ScheduleId};o.CallService(n,l,function(o){o.data.result?(e.HideEventEditor(),swal(i,t.MeetingName+" in "+t.MeetingRoom+" deleted","success"),e.RemoveEventFromList(t)):swal(i,"Failed to delete event, "+o.data.message,"warning")},function(e){swal(i,"Failed to delete event","error")})},e.ShowEventEditor=function(){$("#modalEventEditor").modal("show")},e.HideEventEditor=function(){$("#modalEventEditor").modal("hide")},e.EditEvent=function(o){e.SelectedEvent=JSON.parse(JSON.stringify(o)),e.editMode=!0,e.ShowEventEditor()},e.SubmitEventForm=function(){e.SelectedEvent.MeetingRoomId=e.SelectedRoom.RoomId,e.editMode?e.UpdateEvent(e.SelectedEvent):e.AddEvent(e.SelectedEvent)},e.SubmitMeetingRoomForm=function(){e.SelectedRoom.hid=e.SelectedHotel,e.editMode?e.UpdateMeetingRoom(e.SelectedRoom):e.AddMeetingRoom(e.SelectedRoom)},e.ViewSchedule=function(o){e.GetSchedule(o.RoomId)},$("#modalScheduleEditor").on("shown.bs.modal",function(){}),e.EditRoom=function(o){e.SelectedRoom=JSON.parse(JSON.stringify(o)),e.editMode=!0,e.ShowRoomEditor()},e.DeleteRoom=function(o){swal({title:"Room Delete",text:"Your will not be able to recover this Room!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, remove it!",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!1},function(t){t?e.DeleteMeetingRoom(o):swal("Room delete cancelled","then why did you even click that button??","warning")})},e.RemoveRoomFromList=function(o){var t=e.MeetingRoomList.indexOf(o);e.MeetingRoomList.splice(t,1)},e.AddRoomToList=function(o){e.MeetingRoomList.push(o)},e.UpdateRoomToList=function(o){e.MeetingRoomList.push(o)},e.findRoomID=function(o){for(var t=0;t<e.MeetingRoomList.length;t++)if(e.MeetingRoomList[t].RoomId==o)return t;return null},e.RemoveEventFromList=function(o){var t=e.roomSchedule.indexOf(o);e.roomSchedule.splice(t,1)},e.AddEventToList=function(o){e.roomSchedule.push(o)},e.UpdateEventToList=function(o){e.roomSchedule.push(o)},e.findScheduleID=function(o){for(var t=0;t<e.roomSchedule.length;t++)if(e.roomSchedule[t].ScheduleId==o)return t;return null},e.NewRoom=function(){e.SelectedRoom=null,e.editMode=!1,e.roomEditorForm.$setPristine(),e.ShowRoomEditor()},e.NewEvent=function(){var o=new Date;e.SelectedEvent={StartDate:o.getTime(),EndDate:o.getTime()},e.editMode=!1,e.eventEditorForm.$setPristine(),e.ShowEventEditor()},e.ShowRoomEditor=function(){$("#modalRoomEditor").modal("show")},e.HideRoomEditor=function(){$("#modalRoomEditor").modal("hide")},e.AddMeetingRoom=function(t){showPleaseWait();var i="meetingrooms/Addmeetingroom",n={MeetingRoom:t};o.CallService(i,n,function(o){o.data.result?(t.rid=o.data.message,e.AddRoomToList(t),swal("Meeting Room","Meeting room successfully saved!","success"),e.HideRoomEditor()):swal("Meeting Room","Failed to save meeting room, "+o.data.message,"warning"),hidePleaseWait()},function(e){swal("Meeting Room","Failed to save meeting room","error"),hidePleaseWait()})},e.UpdateMeetingRoom=function(t){showPleaseWait();var i="meetingrooms/updatemeetingroom",n={MeetingRoom:t};o.CallService(i,n,function(o){o.data.result?(swal("Meeting Room","Meeting room successfully updated!","success"),e.HideRoomEditor(),e.MeetingRoomList[e.findRoomID(t.RoomId)]=t):swal("Meeting Room","Failed to update meeting room, "+o.data.message,"warning"),hidePleaseWait()},function(e){swal("Meeting Room","Failed to update meeting room","error"),hidePleaseWait()})},e.DeleteMeetingRoom=function(t){var i="meetingrooms/deletemeetingroom",n={RoomId:t.RoomId};o.CallService(i,n,function(o){o.data.result?(e.HideRoomEditor(),e.RemoveRoomFromList(t),swal("Room delete Confirmed",t.RoomName+" deleted","success")):swal("Meeting Room","Failed to delete meeting room, "+o.data.message,"warning")},function(e){swal("Meeting Room","Failed to delete meeting room","error")})},e.GetMeetingRoom=function(t){var i="meetingrooms/getmeetingroom",n={HotelId:t};o.CallService(i,n,function(o){0==o.data.code?(e.MeetingRoomList=o.data.Rooms,void 0==hotelId?e.SelectedHotel=null:e.SelectedHotel=hotelId):swal("Meeting Room","Failed to load meeting room, "+o.data.message,"warning")},function(e){swal("Meeting Room","Failed to load meeting room","error")})},e.uiConfig={calendar:{height:100,editable:!0,header:{left:"month basicWeek basicDay agendaWeek agendaDay",center:"title",right:"today prev,next"},eventClick:e.calendarEventOnClick,eventDrop:e.calendarOnDrop,eventResize:e.calendarOnResize,eventRender:e.eventRender}},e.roomSchedulee=[{events:[{overlap:"false",title:"Free Pizza",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Free Pizza.</p><p>Nothing to see!</p>",start:"2016-08-12T03:29:43",end:"2016-08-12T04:29:43",url:""},{overlap:"false",title:"DNUG Meeting",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the DNUG Meeting.</p><p>Nothing to see!</p>",start:"2016-08-13T03:29:43",end:"2016-08-13T04:29:43",url:""},{overlap:"false",title:"Staff Meeting",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Staff Meeting.</p><p>Nothing to see!</p>",start:"2016-08-14T03:29:43",end:"2016-08-16T03:29:43",url:""},{overlap:"false",title:"Poker Night",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Poker Night.</p><p>Nothing to see!</p>",start:"2016-07-31T03:29:43",end:"2016-07-31T04:29:43",url:""},{overlap:"false",title:"Beer Garden",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Beer Garden.</p><p>Nothing to see!</p>",start:"2016-08-16T03:29:43",end:"2016-08-16T04:29:43",url:""},{overlap:"false",title:"XBox Tourney",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the XBox Tourney.</p><p>Nothing to see!</p>",start:"2016-08-17T03:29:43",end:"2016-08-19T03:29:43",url:""},{overlap:"false",title:"Pool Party",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Pool Party.</p><p>Nothing to see!</p>",start:"2016-08-18T03:29:43",end:"2016-08-18T04:29:43",url:""},{overlap:"false",title:"Staff Meeting",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Staff Meeting.</p><p>Nothing to see!</p>",start:"2016-08-04T03:29:43",end:"2016-08-04T04:29:43",url:""},{overlap:"false",title:"Poker Night",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Poker Night.</p><p>Nothing to see!</p>",start:"2016-08-26T03:29:43",end:"2016-08-28T03:29:43",url:""},{overlap:"false",title:"Hackathon",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Hackathon.</p><p>Nothing to see!</p>",start:"2016-08-21T03:29:43",end:"2016-08-21T04:29:43",url:""},{overlap:"false",title:"Beta Testing",allday:"false",borderColor:"#5173DA",color:"#99ABEA",textColor:"#000000",description:"<p>This is just a fake description for the Beta Testing.</p><p>Nothing to see!</p>",start:"2016-08-22T03:29:43",end:"2016-08-22T04:29:43",url:""},{overlap:"false",title:"Perl Meetup",allday:"false",borderColor:"#820F20",color:"#A6113C",textColor:"#ffffff",description:"<p>This is just a fake description for the Perl Meetup.</p><p>Nothing to see!</p>",start:"2016-08-12T03:29:43",end:"2016-08-12T05:29:43",url:""},{overlap:"false",title:"Node.js Meetup",allday:"false",borderColor:"#820F20",color:"#A6113C",textColor:"#ffffff",description:"<p>This is just a fake description for the Node.js Meetup.</p><p>Nothing to see!</p>",start:"2016-08-13T03:29:43",end:"2016-08-13T05:29:43",url:""},{overlap:"false",title:"Javascript Meetup",allday:"false",borderColor:"#820F20",color:"#A6113C",textColor:"#ffffff",description:"<p>This is just a fake description for the Javascript Meetup.</p><p>Nothing to see!</p>",start:"2016-08-14T03:29:43",end:"2016-08-15T03:29:43",url:""},{overlap:"false",title:"HTML Meetup",allday:"false",borderColor:"#820F20",color:"#A6113C",textColor:"#ffffff",description:"<p>This is just a fake description for the HTML Meetup.</p><p>Nothing to see!</p>",start:"2016-08-08T03:29:43",end:"2016-08-08T05:29:43",url:""},{overlap:"false",title:"CSS Meetup",allday:"false",borderColor:"#820F20",color:"#A6113C",textColor:"#ffffff",description:"<p>This is just a fake description for the CSS Meetup.</p><p>Nothing to see!</p>",start:"2016-08-16T03:29:43",end:"2016-08-16T05:29:43",url:""}],color:"white",textColor:"white"}],e.roomSchedule=[],e.GetSchedule=function(t){showPleaseWait();var i="meetingrooms/GetAdminRoomDetail",n={RoomId:t};o.CallService(i,n,function(o){0==o.data.code?(e.SelectedRoom=o.data.RoomDetail,e.roomSchedule=o.data.Schedules,e.renderCalender()):swal("Meeting Room","Failed to load meeting room schedule, "+o.data.message,"warning"),hidePleaseWait()},function(e){swal("Meeting Room","Failed to load meeting room schedule","error"),hidePleaseWait()})},e.calendarEventOnClick=function(){swal("Sorry","Calendar event on click function not implemented yet!","warning")},e.calendarOnDrop=function(){swal("Sorry","Calendar on drop function not implemented yet!","warning")},e.calendarOnResize=function(){swal("Sorry","Calendar on resize function not implemented yet!","warning")},e.changeView=function(e,o){n.calendars[o].fullCalendar("changeView",e)},e.renderCalender=function(e){n.calendars[e]&&n.calendars[e].fullCalendar("render")},e.eventRender=function(o,t,i){t.attr({tooltip:o.title,"tooltip-append-to-body":!0}),$compile(t)(e)};var l=new Date,r=(l.getDate(),l.getMonth()),a=l.getFullYear();e.addEvent=function(){e.roomSchedule.push({title:"Open Sesame",start:new Date(a,r,28),end:new Date(a,r,29),className:["openSesame"]})},e.remove=function(o){e.roomSchedule.splice(o,1)},e.GridHistoryGetTotalPages=function(){return null==e.SelectedMemberCheckIn||null==e.SelectedMemberCheckIn.Personal?[]:Math.ceil(e.SelectedMemberCheckIn.Personal.CheckInHistories.length/e.pageSize)},e.displayDate=function(e,o){return null==e?"":null!=o?moment(e).format(o):moment(e).fromNow()},e.GridCheckInListOptions=t.newOptions(),e.GridCheckInListColumnDefs=[i.newColumnDef(0)],e.GridHistoryOptions=t.newOptions(),e.GridHistoryColumns=[i.newColumnDef(0)],e.curPage=1,e.pageSize=10}WebGuest.controller("MeetingRoomController",["$scope","CallNetworkService","DTOptionsBuilder","DTColumnDefBuilder","uiCalendarConfig",MeetingRoomController]),WebGuest.directive("datetimez",function(){return{restrict:"A",require:"ngModel",link:function(e,o,t,i){o.datetimepicker({dateFormat:"dd/MM/yyyy hh:mm:ss",language:"en"}).on("changeDate",function(o){i.$setViewValue(o.date),e.$apply()})}}});
function MemberManagementController(e,t,n,r,o){function l(t,n,r,o){return $(t).addClass("cellColor"),$("td",t).unbind("click"),$("td",t).bind("click",function(){e.$apply(function(){e.someClickHandler(n)})}),t}e.BookingMethods=WebApp.BookingMethods,e.SelectedBookingMethod="-1",e.SelectedMember,e.SelectedHotel=null,e.ResetSelectedRequest=function(){e.SelectedRequest=null},e.Process=function(t){e.SelectedRequest=t,e.ShowMemberEditor()},e.OpenNewMemberEditor=function(){var t={isNew:!0,CardNumber:"",Email:"",Gender:"",TelephoneNumber:"",MembershipType:"",NickName:""};e.ShowMemberEditor(),e.SelectedMember=t},e.ShowMemberEditor=function(){e.memberSaveButtonPushed=!1,e.memberEditorForm.$setPristine(!0),e.IsIncluded=null,e.IsOwner=null,e.SelectedHotelMember=null,void 0!=e.SelectedOwnerMember&&(e.SelectedOwnerMember.HotelId="",e.SelectedOwnerMember.ReferenceId=""),$("#modalMemberEditor").modal("show")},e.HideMemberEditor=function(){e.reloadData(),$("#modalMemberEditor").modal("hide")},e.ConfirmApproval=function(t){var n="Checkin Request Approval";return"-1"===e.SelectedBookingMethod?void swal(n,"Please select Booking Method first","error"):void swal({title:n,text:"Approve "+t.MemberName+"'s request?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&e.ProcessRequest(t,!0)})},e.RejectApproval=function(t){swal({title:"Checkin Request Rejection",text:"Reject "+t.MemberName+"'s request?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#DD6B55",confirmButtonText:"Reject",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(n){n&&e.ProcessRequest(t,!1)})},e.ProcessRequest=function(t,r){var o=(r?"Approve":"Reject")+" Request";showPleaseWait();var l="CheckinRequest/ProcessRequest",a={processby:e.operator,requestId:t.RequestId,isApproved:r,BookingMethod:e.SelectedBookingMethod};n.CallService(l,a,function(t){if(0===t.data.code){swal(o,"Success!","success"),e.HideProcessModal();var n=$("#filterCheckInRequestDefaultList").val();""==n&&(n=null),e.GetCheckinRequestApproval(n)}else swal(o,"Process failed, "+t.data.message,"warning");hidePleaseWait()},function(e){swal(o,"Process failed","error"),hidePleaseWait()})},e.GetCheckinRequestApproval=function(t){var r="Checkin Request",o="CheckinRequest/GetList",l={HotelID:t};n.CallService(o,l,function(n){0==n.data.code?(e.CheckinRequestApprovalList=n.data.checkinRequest,e.SelectedHotel=t):swal(r,"Failed to load "+r+", "+n.data.message,"warning")},function(e){swal(r,"Failed to load "+r,"error")})},e.SaveMemberInfo=function(){if(e.memberSaveButtonPushed=!0,null!=e.SelectedMember.isNew&&e.SelectedMember.isNew&&e.memberEditorForm.$valid||null==e.SelectedMember.isNew&&e.memberEditorForm.ddlMembershipType.$valid){var t="Save Member Data";swal({title:t,text:"Save member info changes?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(t){if(t){var n=null,r=null;void 0!=e.SelectedOwnerMember&&(n=e.SelectedOwnerMember.HotelId,r=e.SelectedOwnerMember.ReferenceId),e.SelectedMember.isNew?e.AddNewMember(e.SelectedMember,n,r):e.UpdateMemberType(e.SelectedMember.Email,n,r,e.SelectedMember.MembershipType)}})}},e.AddNewMember=function(t,r,o){var l="Add New Member",a="Member/AddNewMember",i={info:t,hotelId:r,OwnerId:o};n.CallService(a,i,function(t){0===t.data.code?(e.HideMemberEditor(),swal(l,"Suscess!","success")):swal(l,t.message,"error")},function(e){swal(l,"Failed!","error")})},e.UpdateMemberType=function(t,r,o,l){var a="Update Member Type",i="Member/UpdateMemberType",c={Email:t,hotelId:r,MemberType:l,OwnerId:o};n.CallService(i,c,function(t){0===t.data.code?(e.HideMemberEditor(),swal(a,"Success!","success")):swal(a,t.message,"error")},function(e){swal(a,"Failed!","error")})},e.DeleteOwnership=function(e,t){var n="Delete Ownership";swal({title:n,text:"Delete "+t+" ownership?This might also change "+t+"'s type to Basic",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(e){e&&swal(n,"function not ready yet!","success")})},e.ConfirmSetMemberAsOwner=function(){var t="Set Member as Owner";t="Update Owner",swal({title:t,text:"Set Member as Hotel Owner?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(t){t&&e.SetMemberAsOwner(e.SelectedMember.Email,e.SelectedOwnerMember.HotelId)})},e.SetMemberAsOwner=function(t,r){var o="Set Member as Owner",l="Admin/SetMemberAsOwner",a={Email:t,HotelId:r};n.CallService(l,a,function(t){0===t.data.code?(e.IsOwner=t.data.IsIncluded,e.IsIncluded=t.data.IsIncluded,e.SelectedHotelMember=t.data.OwnerMember,swal(o,"Success!","success")):(swal(o,"Failed!","error"),hidePleaseWait())},function(e){swal(o,"Failed!","error")})},e.ConfirmSetMemberWithReference=function(t,n){var r="Set Ownership";swal({title:r,text:"Set Ownership  with "+n+" as reference?",type:"info",showCancelButton:!0,cancelButtonText:"Cancel",confirmButtonColor:"#55BC77",confirmButtonText:"Approve",showLoaderOnConfirm:!0,closeOnConfirm:!1,closeOnCancel:!0},function(r){r&&e.SetMemberWithReference(e.SelectedMember.Email,e.SelectedOwnerMember.HotelId,t,n)})},e.SetMemberWithReference=function(t,r,o,l){var a="Set Member as Owner",i="Admin/SetMemberWithReference",c={Email:t,hotelId:r,ReferenceId:o};n.CallService(i,c,function(t){0===t.data.code?(e.IsOwner=t.data.IsIncluded,e.IsIncluded=t.data.IsIncluded,e.SelectedHotelMember=t.data.OwnerMember,swal(a,"Success!","success")):(swal(a,"Failed!","error"),hidePleaseWait())},function(e){swal(a,"Failed!","error")})},e.CheckMemberIsOwner=function(t){showPleaseWait();var r="Admin/CheckMemberIsOwner",o={Email:t};n.CallService(r,o,function(t){0===t.data.code&&(e.showOwnerEditor=!1,void 0===t.data.Owner&&(e.showOwnerEditor=!0),e.SelectedHotelOwner=t.data.Owner,e.SelectedHotelMember=t.data.OwnerMember),hidePleaseWait()},function(e){hidePleaseWait()})},e.GetHotelOwnerMember=function(t,r){showPleaseWait();var o="Admin/GetHotelOwnerMember",l={HotelId:t,Email:r};""===t?(e.IsOwner=null,e.IsIncluded=null,e.SelectedHotelMember=null,hidePleaseWait()):n.CallService(o,l,function(t){0===t.data.code&&(e.IsOwner=t.data.IsIncluded,e.IsIncluded=t.data.IsIncluded,e.SelectedHotelMember=t.data.OwnerMember),hidePleaseWait()},function(e){hidePleaseWait()})},e.dtColumns=[o.newColumn("CardNumber","Member No").withOption("name","CardNumber"),o.newColumn("Email","Email").withOption("name","Email"),o.newColumn("FullName"," Name").withOption("name","FullName"),o.newColumn("TelephoneNumber","Phone").withOption("name","TelephoneNumber"),o.newColumn("MembershipType"," Member Type").withOption("name","MembershipType")],e.dtOptions=r.newOptions().withOption("ajax",{dataSrc:"data",url:apiServer+"/WebGuest/GetMemberData",type:"POST"}).withOption("rowCallback",l).withOption("processing",!0).withOption("serverSide",!0).withPaginationType("full_numbers").withDisplayLength(10).withOption("aaSorting",[0,"asc"]),e.someClickHandler=function(t){e.ShowMemberEditor(),e.SelectedMember=t},e.message="",e.dtInstance={},e.reloadData=function(){e.dtInstance._renderer.rerender()}}WebGuest.controller("MemberManagementController",["$scope","$http","CallNetworkService","DTOptionsBuilder","DTColumnBuilder",MemberManagementController]);
function MembershipChartController(e,t){function a(){var t=e.chartDivId,a=e.currentArrayData,r=google.visualization.arrayToDataTable(a),i={vAxis:{viewWindow:{min:0},textStyle:{color:"#005500",fontSize:"12",paddingRight:"100",marginRight:"100"}},hAxis:{direction:-1,slantedText:!0,slantedTextAngle:45,textStyle:{color:"#005500",fontSize:"12",paddingRight:"100",marginRight:"100"}},width:1e3,height:400,pointSize:5,animation:{duration:1e3,easing:"out",startup:!0}},n={};switch(e.chartType){case"bar":n=new google.visualization.ColumnChart(document.getElementById(t));break;case"line":n=new google.visualization.LineChart(document.getElementById(t));break;case"pie":n=new google.visualization.PieChart(document.getElementById(t))}n.draw(r,i),e.chartRendered=!0}var r={};e.dataType="member-stay",e.hotel="",e.isLoading=!1,e.chartRendered=!1,e.chartDivId="membership-chart-area",e.currentArrayData=[],e.chartType="line",e.agregateByHotel=!1,e.sumbitChartForm=function(){e.isLoading=!0,console.log("HOTEL",e.hotel);var i=$("#date_from").val(),n=$("#date_to").val(),o={url:WebApp.BaseUrl+"/WebAdmin/GetMemberChartData",data:{hotel:e.hotel,dateFrom:i,dateTo:n,dataType:e.dataType,agregateByHotel:e.agregateByHotel}};r=t.get(o,function(t){var r=[];t.data.forEach(function(e,t){var a=e[0],i=e[1];t>0&&(i=parseInt(i)),r.push([a,i])}),e.currentArrayData=r,a(),e.isLoading=!1},function(t){e.isLoading=!1})},e.cancelChartRequest=function(){e.isLoading=!1,null!=r&&r.abort()},e.changeChartType=function(t){e.chartType=t,a()}}WebGuest.controller("MembershipChartController",["$scope","BaseService",MembershipChartController]);
function MembershipMapController(e,o){e.filterKeyword="",e.Members=[],e.LocationName="",e.showMemberList=function(e){var o=$("#map-member-list");if(e){if(o.is(":visible"))return;o.show(),o.css("display","flex")}else o.hide()},e.loadMembersByCoordinate=function(r,i){var t={url:WebApp.BaseUrl+"/WebAdmin/GetMembersByCoordinates",data:{latitude:r,longitude:i}};o.get(t,function(o){var r=o.data;e.Members=r.members,e.LocationName=r.locationName},function(){},function(){})}}WebGuest.controller("MembershipMapController",["$scope","BaseService",MembershipMapController]);